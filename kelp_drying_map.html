<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>åˆ©å°»å³¶æ˜†å¸ƒå¹²å ´ãƒãƒƒãƒ— - 7æ—¥é–“äºˆå ±ã‚·ã‚¹ãƒ†ãƒ </title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Chart.js for forecast charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- å¹²å ´ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ -->
    <script src="all_spots_array.js?v=20251010"></script>

    <!-- åˆ©å°»å³¶ä¼çµ±é¢¨åã‚·ã‚¹ãƒ†ãƒ  (ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³èª­ã¿è¾¼ã¿) -->
    <script>
    // åˆ©å°»å³¶16æ–¹ä½ä¼çµ±é¢¨åãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
    const RISHIRI_WIND_NAMES = [
        { meteoDirection: 0,     kanbaTheta: 177.2, name: "ã‚¢ã‚¤",         reading: "ai",            cardinal: "åŒ—",   cardinal16: "N" },
        { meteoDirection: 22.5,  kanbaTheta: 154.7, name: "ã‚¢ã‚¤ã‚·ãƒ¢",     reading: "aishimo",       cardinal: "åŒ—åŒ—æ±", cardinal16: "NNE" },
        { meteoDirection: 45,    kanbaTheta: 132.2, name: "ã‚·ãƒ¢",         reading: "shimo",         cardinal: "åŒ—æ±",  cardinal16: "NE" },
        { meteoDirection: 67.5,  kanbaTheta: 109.7, name: "ã‚·ãƒ¢ãƒ¤ãƒã‚»",   reading: "shimoyamase",   cardinal: "æ±åŒ—æ±", cardinal16: "ENE" },
        { meteoDirection: 90,    kanbaTheta: 87.2,  name: "ãƒ›ãƒ³ãƒ¤ãƒã‚»",   reading: "honyamase",     cardinal: "æ±",   cardinal16: "E" },
        { meteoDirection: 112.5, kanbaTheta: 64.7,  name: "ãƒ¤ãƒã‚»",       reading: "yamase",        cardinal: "æ±å—æ±", cardinal16: "ESE" },
        { meteoDirection: 135,   kanbaTheta: 42.2,  name: "ãƒŸãƒŠãƒŸãƒ¤ãƒã‚»", reading: "minamiyamase",  cardinal: "å—æ±",  cardinal16: "SE" },
        { meteoDirection: 157.5, kanbaTheta: 19.7,  name: "ãƒŸãƒŠãƒŸãƒ¤ãƒ",   reading: "minamiyama",    cardinal: "å—å—æ±", cardinal16: "SSE" },
        { meteoDirection: 180,   kanbaTheta: 357.2, name: "ã‚¯ãƒ€ãƒª",       reading: "kudari",        cardinal: "å—",   cardinal16: "S" },
        { meteoDirection: 202.5, kanbaTheta: 334.7, name: "ã‚¯ãƒ€ãƒªãƒ’ã‚«ã‚¿", reading: "kudarihikata",  cardinal: "å—å—è¥¿", cardinal16: "SSW" },
        { meteoDirection: 225,   kanbaTheta: 312.2, name: "ãƒ’ã‚«ã‚¿",       reading: "hikata",        cardinal: "å—è¥¿",  cardinal16: "SW" },
        { meteoDirection: 247.5, kanbaTheta: 289.7, name: "ãƒ‹ã‚·ãƒ’ã‚«ã‚¿",   reading: "nishihikata",   cardinal: "è¥¿å—è¥¿", cardinal16: "WSW" },
        { meteoDirection: 270,   kanbaTheta: 267.2, name: "ãƒ‹ã‚·",         reading: "nishi",         cardinal: "è¥¿",   cardinal16: "W" },
        { meteoDirection: 292.5, kanbaTheta: 244.7, name: "ãƒ‹ã‚·ã‚¿ãƒ",     reading: "nishitama",     cardinal: "è¥¿åŒ—è¥¿", cardinal16: "WNW" },
        { meteoDirection: 315,   kanbaTheta: 222.2, name: "ã‚¿ãƒ",         reading: "tama",          cardinal: "åŒ—è¥¿",  cardinal16: "NW" },
        { meteoDirection: 337.5, kanbaTheta: 199.7, name: "ã‚¢ã‚¤ã‚¿ãƒ",     reading: "aitama",        cardinal: "åŒ—åŒ—è¥¿", cardinal16: "NNW" }
    ];

    function getRishiriWindName(meteorologicalDirection) {
        if (meteorologicalDirection === null || meteorologicalDirection === undefined) {
            return "--";
        }
        const normalizedDir = ((meteorologicalDirection % 360) + 360) % 360;
        let minDiff = 360;
        let closestWind = RISHIRI_WIND_NAMES[0];
        for (const wind of RISHIRI_WIND_NAMES) {
            let diff = Math.abs(normalizedDir - wind.meteoDirection);
            diff = Math.min(diff, 360 - diff);
            if (diff < minDiff) {
                minDiff = diff;
                closestWind = wind;
            }
        }
        return closestWind.name;
    }

    function meteorologicalToKanbaTheta(meteorologicalDirection) {
        if (meteorologicalDirection === null || meteorologicalDirection === undefined) {
            return null;
        }
        let kanbaTheta = 177.2 - meteorologicalDirection;
        if (kanbaTheta < 0) {
            kanbaTheta += 360;
        }
        return kanbaTheta;
    }

    function getRishiriWindDetails(meteorologicalDirection) {
        if (meteorologicalDirection === null || meteorologicalDirection === undefined) {
            return {
                name: "--",
                reading: "--",
                cardinal: "--",
                cardinal16: "--",
                kanbaTheta: null
            };
        }
        const normalizedDir = ((meteorologicalDirection % 360) + 360) % 360;
        let minDiff = 360;
        let closestWind = RISHIRI_WIND_NAMES[0];
        for (const wind of RISHIRI_WIND_NAMES) {
            let diff = Math.abs(normalizedDir - wind.meteoDirection);
            diff = Math.min(diff, 360 - diff);
            if (diff < minDiff) {
                minDiff = diff;
                closestWind = wind;
            }
        }
        return {
            name: closestWind.name,
            reading: closestWind.reading,
            cardinal: closestWind.cardinal,
            cardinal16: closestWind.cardinal16,
            kanbaTheta: meteorologicalToKanbaTheta(meteorologicalDirection)
        };
    }

    function getWindArrow(direction) {
        const arrows = ['â†“', 'â†™', 'â†', 'â†–', 'â†‘', 'â†—', 'â†’', 'â†˜'];
        const index = Math.round(direction / 45) % 8;
        return arrows[index];
    }
    </script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .container {
            display: flex;
            height: calc(100vh - 100px);
            background: white;
            margin: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        #map {
            flex: 1;
            height: 100%;
        }

        .forecast-panel {
            width: 420px;
            background: #f8f9fa;
            border-left: 1px solid #e9ecef;
            overflow-y: auto;
            padding: 20px;
            display: none;
            max-height: 80vh;
        }

        .forecast-panel.active {
            display: block;
        }

        .forecast-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .forecast-tabs {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }

        .forecast-tab {
            padding: 8px 12px;
            background: #e9ecef;
            border: 1px solid #ddd;
            border-bottom: none;
            cursor: pointer;
            font-size: 0.85rem;
            border-radius: 5px 5px 0 0;
            margin-right: 2px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .forecast-tab.active {
            background: white;
            border-color: #667eea;
            color: #667eea;
            font-weight: bold;
        }

        .forecast-tab:hover {
            background: #f8f9fa;
        }

        .forecast-content {
            display: none;
        }

        .forecast-content.active {
            display: block;
        }

        .reliability-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .reliability-high { background: #d4edda; color: #155724; }
        .reliability-medium { background: #fff3cd; color: #856404; }
        .reliability-low { background: #f8d7da; color: #721c24; }

        .hourly-section {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #e9ecef;
        }

        /* ä¸€èˆ¬/å°‚é–€å®¶å‘ã‘ã‚¿ãƒ– */
        .view-mode-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .view-mode-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s;
        }

        .view-mode-tab:hover {
            color: #667eea;
        }

        .view-mode-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        /* æ™‚é–“åˆ¥äºˆå ±ãƒ†ãƒ¼ãƒ–ãƒ« */
        .hourly-table-container {
            overflow-x: auto;
            margin-top: 10px;
        }

        .hourly-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .hourly-table th {
            background: #667eea;
            color: white;
            padding: 10px 5px;
            text-align: center;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .hourly-table td {
            padding: 8px 5px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .hourly-table tr:hover {
            background: #f8f9fa;
        }

        .hourly-table .time-cell {
            font-weight: bold;
            color: #667eea;
            background: #f0f4ff;
        }

        .hourly-table .expert-row {
            display: none;
        }

        .hourly-table .general-row {
            display: table-row;
        }

        .hourly-table.show-expert .expert-row {
            display: table-row;
        }

        .hourly-table.show-expert .general-row {
            display: none;
        }

        /* æ—§ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå¾Œæ–¹äº’æ›æ€§ã®ãŸã‚æ®‹ã™ï¼‰ */
        .hourly-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .hourly-item {
            text-align: center;
            padding: 8px 4px;
            background: #f8f9fa;
            border-radius: 5px;
            font-size: 0.8rem;
        }

        .hourly-time {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .forecast-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
        }

        .forecast-date {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .forecast-data {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9rem;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }

        .suitability {
            text-align: center;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 10px;
        }

        .excellent { background: #d4edda; color: #155724; }
        .good { background: #cce7ff; color: #004085; }
        .fair { background: #fff3cd; color: #856404; }
        .poor { background: #f8d7da; color: #721c24; }

        .instructions {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin: 20px;
            text-align: center;
        }

        .chart-container {
            margin: 20px 0;
            background: white;
            padding: 15px;
            border-radius: 10px;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
            color: #667eea;
            font-size: 1.2rem;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Custom marker styles */
        .custom-div-icon {
            background: linear-gradient(135deg, #667eea, #764ba2);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .selected-marker {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f) !important;
            transform: scale(1.3);
        }

        .favorite-controls {
            padding: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .spot-management-controls {
            padding: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .management-btn {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }

        .management-btn.add {
            background: #28a745;
            color: white;
        }

        .management-btn.add:hover {
            background: #218838;
        }

        .management-btn.delete {
            background: #dc3545;
            color: white;
        }

        .management-btn.delete:hover {
            background: #c82333;
        }

        .instructions {
            color: #666;
            font-style: italic;
            margin-top: 10px;
        }

        .record-form {
            background: rgba(255, 255, 255, 0.98);
            border: 2px solid #17a2b8;
            border-radius: 10px;
            padding: 20px;
            margin: 10px 0;
            max-width: 350px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .record-form h4 {
            color: #17a2b8;
            margin-bottom: 15px;
        }

        .record-form input[type="date"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .record-buttons {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin: 10px 0;
        }

        .record-btn {
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .record-btn.success {
            background: #28a745;
            color: white;
        }

        .record-btn.warning {
            background: #ffc107;
            color: black;
        }

        .record-btn.danger {
            background: #dc3545;
            color: white;
        }

        .record-btn:hover {
            opacity: 0.8;
        }

        .existing-record {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #6c757d;
        }

        .filter-controls {
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .filter-section {
            margin-bottom: 15px;
        }

        .filter-section h4 {
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 1rem;
        }

        .filter-select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.9rem;
            background: white;
            color: #495057;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .filter-breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: #6c757d;
        }

        .breadcrumb-item {
            cursor: pointer;
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }

        .breadcrumb-item:hover {
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #adb5bd;
        }

        .filter-stats {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #495057;
        }

        .favorite-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 0.9rem;
        }

        .favorite-btn:hover {
            background: #218838;
        }

        .favorite-btn.remove {
            background: #dc3545;
        }

        .favorite-btn.remove:hover {
            background: #c82333;
        }

        .favorites-list {
            background: white;
            border-radius: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .favorite-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .favorite-item:hover {
            background: #f8f9fa;
        }

        .favorite-marker {
            background: linear-gradient(135deg, #28a745, #20c997) !important;
        }

        .feedback-section {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .feedback-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .feedback-btn {
            padding: 5px 8px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
            flex: 1;
            min-width: 45px;
        }

        .feedback-btn.excellent { background: #d4edda; color: #155724; }
        .feedback-btn.good { background: #cce7ff; color: #004085; }
        .feedback-btn.fair { background: #fff3cd; color: #856404; }
        .feedback-btn.poor { background: #f8d7da; color: #721c24; }

        .feedback-btn:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .feedback-submitted {
            background: #e9ecef !important;
            color: #6c757d !important;
            cursor: not-allowed;
        }

        .expert-only {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸŒŠ åˆ©å°»å³¶æ˜†å¸ƒå¹²å ´äºˆå ±ã‚·ã‚¹ãƒ†ãƒ </h1>
        <p>å¹²å ´ã‚’é¸æŠã—ã¦7æ—¥é–“ã®ä¹¾ç‡¥é©æ€§äºˆå ±ã‚’ç¢ºèªã§ãã¾ã™</p>
        <div id="connectionStatus" style="margin-top: 10px; padding: 8px 15px; border-radius: 20px; display: inline-block; font-size: 0.9rem; font-weight: 500;">
            <span id="statusIcon">ğŸŒ</span> <span id="statusText">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</span>
        </div>
    </div>

    <div class="instructions">
        <strong>ä½¿ã„æ–¹:</strong> åœ°å›³ä¸Šã®ğŸ”µãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãã®å¹²å ´ã®è©³ç´°ãª7æ—¥é–“äºˆå ±ãŒå³å´ã«è¡¨ç¤ºã•ã‚Œã¾ã™
    </div>

    <div class="favorite-controls">
        <h4>ğŸŒŸ ãŠæ°—ã«å…¥ã‚Šå¹²å ´ç®¡ç†</h4>
        <button id="showFavoritesBtn" class="favorite-btn">ãŠæ°—ã«å…¥ã‚Šä¸€è¦§</button>
        <button id="clearFavoritesBtn" class="favorite-btn remove">å…¨ã¦å‰Šé™¤</button>

        <div id="favoritesList" class="favorites-list" style="display: none;">
            <div id="favoritesContent"></div>
        </div>
    </div>

    <div class="notification-controls" style="background: white; padding: 20px; margin: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
        <h4>ğŸ”” é€šçŸ¥è¨­å®š</h4>
        <div style="margin: 15px 0;">
            <label style="display: flex; align-items: center; cursor: pointer;">
                <input type="checkbox" id="notificationEnabled" onchange="toggleNotifications()" style="margin-right: 10px; width: 20px; height: 20px;">
                <span>åˆå¾Œ4æ™‚ã«äºˆå ±é€šçŸ¥ã‚’å—ã‘å–ã‚‹</span>
            </label>
        </div>

        <div id="notificationSettings" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">
                ãŠæ°—ã«å…¥ã‚Šå¹²å ´ã®æ˜æ—¥ã®äºˆå ±ã‚’æ¯æ—¥åˆå¾Œ4æ™‚ã«é€šçŸ¥ã—ã¾ã™
            </p>

            <div style="margin: 15px 0;">
                <h5 style="font-size: 0.95rem; margin-bottom: 10px;">é€šçŸ¥å¯¾è±¡å¹²å ´</h5>
                <div id="notificationSpotsList" style="font-size: 0.85rem; color: #555;">
                    ãŠæ°—ã«å…¥ã‚Šã«å¹²å ´ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
                </div>
            </div>

            <div style="margin: 15px 0;">
                <h5 style="font-size: 0.95rem; margin-bottom: 10px;">ğŸš¢ æ²–æ­¢ã‚æ—¥è¨­å®š</h5>
                <p style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">æ˜†å¸ƒæ¼ãŒä¼‘ã¿ã®æ—¥ã‚’è¨­å®šã™ã‚‹ã¨ã€ãã®å‰æ—¥ã¯é€šçŸ¥ã•ã‚Œã¾ã›ã‚“</p>
                <input type="date" id="offDayDate" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 100%;">
                <button onclick="addOffDay()" style="margin-top: 8px; padding: 8px 15px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
                    æ²–æ­¢ã‚æ—¥ã‚’è¿½åŠ 
                </button>
                <div id="offDaysList" style="margin-top: 10px; font-size: 0.85rem;">
                </div>
            </div>

            <div style="margin: 15px 0;">
                <h5 style="font-size: 0.95rem; margin-bottom: 10px;">ğŸ“… æ¼æœŸè¨­å®š</h5>
                <div style="margin-bottom: 8px;">
                    <label style="font-size: 0.85rem; color: #666;">é–‹å§‹æ—¥:</label>
                    <input type="date" id="seasonStartDate" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 100%; margin-top: 5px;">
                </div>
                <div style="margin-bottom: 8px;">
                    <label style="font-size: 0.85rem; color: #666;">çµ‚äº†æ—¥:</label>
                    <input type="date" id="seasonEndDate" style="padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 100%; margin-top: 5px;">
                </div>
                <button onclick="saveSeasonDates()" style="margin-top: 8px; padding: 8px 15px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
                    æ¼æœŸã‚’ä¿å­˜
                </button>
                <p style="font-size: 0.75rem; color: #999; margin-top: 8px;">â€» 6æœˆï½9æœˆãŒæ¨å¥¨ã§ã™</p>
            </div>

            <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px;">
                <p style="font-size: 0.8rem; color: #856404; margin: 0;">
                    âš ï¸ ãƒ–ãƒ©ã‚¦ã‚¶ã®é€šçŸ¥è¨±å¯ãŒå¿…è¦ã§ã™ã€‚åˆå›ã¯è¨±å¯ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
                </p>
            </div>
        </div>
    </div>

    <div class="spot-management-controls">
        <h4>ğŸ“ å¹²å ´ç®¡ç†</h4>
        <button id="addSpotBtn" class="management-btn add" onclick="enableAddSpotMode()">â• æ–°ã—ã„å¹²å ´ã‚’è¿½åŠ </button>
        <p id="addSpotInstructions" class="instructions" style="display: none;">
            åœ°å›³ä¸Šã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æ–°ã—ã„å¹²å ´ã‚’è¿½åŠ ã—ã¦ãã ã•ã„
        </p>
    </div>

<!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="sidebar-tabs" style="background: white; margin: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow: hidden;">
        <div class="sidebar-tab-header" style="display: flex; border-bottom: 2px solid #e9ecef;">
            <button class="sidebar-tab-btn active" onclick="switchSidebarTab('filter')" data-tab="filter" style="flex: 1; padding: 15px; background: white; border: none; border-bottom: 3px solid #667eea; cursor: pointer; font-weight: 600; color: #667eea; transition: all 0.3s;">
                ğŸ“ ã‚¨ãƒªã‚¢çµè¾¼
            </button>
            <button class="sidebar-tab-btn" onclick="switchSidebarTab('contour')" data-tab="contour" style="flex: 1; padding: 15px; background: white; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 500; color: #6c757d; transition: all 0.3s;">
                ğŸŒªï¸ ç­‰å€¤ç·šè§£æ
            </button>
        </div>

        <div class="sidebar-tab-content active" id="filterTabContent" style="padding: 20px;">
            <div class="filter-breadcrumb" id="filterBreadcrumb">
                <span class="breadcrumb-item" onclick="resetFilters()">å…¨ã‚¨ãƒªã‚¢</span>
            </div>

            <div class="filter-section">
                <h4>ç”ºã‚’é¸æŠ</h4>
                <select id="townSelect" class="filter-select" onchange="filterByTown()">
                    <option value="">-- ç”ºã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                    <option value="åˆ©å°»å¯Œå£«ç”º">åˆ©å°»å¯Œå£«ç”º</option>
                    <option value="åˆ©å°»ç”º">åˆ©å°»ç”º</option>
                </select>
            </div>

            <div class="filter-section" id="districtSection" style="display: none;">
                <h4>åœ°åŒºã‚’é¸æŠ</h4>
                <select id="districtSelect" class="filter-select" onchange="filterByDistrict()">
                    <option value="">-- åœ°åŒºã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                </select>
            </div>

            <div class="filter-section" id="burakuSection" style="display: none;">
                <h4>éƒ¨è½ã‚’é¸æŠ</h4>
                <select id="burakuSelect" class="filter-select" onchange="filterByBuraku()">
                    <option value="">-- éƒ¨è½ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>
                </select>
            </div>

            <div class="filter-stats" id="filterStats">
                è¡¨ç¤ºä¸­: 331ç®‡æ‰€ã®å¹²å ´
            </div>
        </div>

        <div class="sidebar-tab-content" id="contourTabContent" style="padding: 20px; display: none;">
            <h4 style="margin-bottom: 15px; color: #2c3e50;">ğŸŒªï¸ å³¶å†…å…¨åŸŸæ°—è±¡è§£æ</h4>
            <p style="font-size: 0.85rem; color: #666; margin-bottom: 20px;">
                åˆ©å°»å³¶å…¨ä½“ã®æ°—è±¡çŠ¶æ³ã‚’ç­‰å€¤ç·šãƒãƒƒãƒ—ã§æ¦‚è¦³ã§ãã¾ã™
            </p>

            <div class="filter-section">
                <h4>è§£æã‚«ãƒ†ã‚´ãƒªãƒ¼</h4>
                <select id="contourCategory" class="filter-select" onchange="updateContourTimeOptions()">
                    <option value="">-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠ --</option>
                    <optgroup label="åœ°ä¸Šãƒ¬ãƒ™ãƒ«ï¼ˆ1æ™‚é–“åˆ»ã¿ï¼‰">
                        <option value="temperature">ğŸŒ¡ï¸ ç­‰æ¸©ç·šï¼ˆæ°—æ¸©åˆ†å¸ƒï¼‰</option>
                        <option value="humidity">ğŸ’§ ç­‰æ¹¿ç·šï¼ˆæ¹¿åº¦åˆ†å¸ƒï¼‰</option>
                        <option value="pressure">ğŸ“Š ç­‰åœ§ç·šï¼ˆæ°—åœ§åˆ†å¸ƒï¼‰</option>
                        <option value="wind">ğŸ’¨ é¢¨å‘ãƒ»é¢¨é€Ÿå ´</option>
                        <option value="precipitation">ğŸŒ§ï¸ é™æ°´é‡åˆ†å¸ƒ</option>
                    </optgroup>
                    <optgroup label="æµ·åŸŸãƒ¬ãƒ™ãƒ«ï¼ˆ1æ™‚é–“åˆ»ã¿ï¼‰">
                        <option value="wave_height">ğŸŒŠ æœ‰ç¾©æ³¢é«˜åˆ†å¸ƒ</option>
                        <option value="wave_direction_period">ğŸŒŠ æ³¢å‘ãƒ»æ³¢å‘¨æœŸå ´</option>
                    </optgroup>
                    <optgroup label="é«˜å±¤ãƒ¬ãƒ™ãƒ«ï¼ˆ3æ™‚é–“åˆ»ã¿ï¼‰">
                        <option value="vorticity_500hpa">ğŸŒ€ æ¸¦åº¦å ´ï¼ˆ500hPaï¼‰</option>
                        <option value="omega_700hpa">â¬‡ï¸ é‰›ç›´æµï¼ˆ700hPaï¼‰</option>
                        <option value="theta_e_850hpa">ğŸŒ¡ï¸ ç›¸å½“æ¸©ä½ï¼ˆ850hPaï¼‰</option>
                    </optgroup>
                    <optgroup label="è¶…é«˜å±¤ãƒ¬ãƒ™ãƒ«ï¼ˆé•·æœŸäºˆæ¸¬ãƒ»3æ™‚é–“åˆ»ã¿ï¼‰">
                        <option value="jet_stream_300hpa">âœˆï¸ ã‚¸ã‚§ãƒƒãƒˆæ°—æµï¼ˆ300hPaï¼‰</option>
                        <option value="height_anomaly_200hpa">ğŸ“ˆ é«˜åº¦åå·®ï¼ˆ200hPaï¼‰</option>
                    </optgroup>
                </select>
            </div>

            <div class="filter-section">
                <h4>è§£ææ™‚åˆ»ï¼ˆJSTï¼‰</h4>
                <select id="contourTime" class="filter-select" onchange="updateContourDisplay()">
                    <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                </select>
            </div>

            <button onclick="loadContourAnalysis()" style="width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 10px; transition: all 0.3s;">
                ğŸ” è§£æå›³ã‚’è¡¨ç¤º
            </button>

            <div id="contourMapDisplay" style="margin-top: 20px; background: #f8f9fa; border-radius: 8px; padding: 15px; min-height: 200px; display: none;">
                <h5 style="margin-bottom: 10px; color: #667eea;">è§£æçµæœ</h5>
                <div id="contourMapImage" style="text-align: center;">
                    <p style="color: #999;">è§£æå›³ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
                <div id="contourMetadata" style="margin-top: 15px; font-size: 0.8rem; color: #666; border-top: 1px solid #ddd; padding-top: 10px;">
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="map"></div>

        <!-- è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆéè¡¨ç¤ºï¼‰ -->
        <div id="recordFormContainer" class="record-form" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000;">
            <h4>ğŸ“ ä¹¾ç‡¥è¨˜éŒ²ã®å…¥åŠ›</h4>
            <div id="recordSpotInfo"></div>
            <label for="recordDate">æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„:</label>
            <input type="date" id="recordDate" />
            <div id="existingRecordInfo"></div>
            <div id="recordButtons" class="record-buttons">
                <button class="record-btn success" onclick="submitRecord('å®Œå…¨ä¹¾ç‡¥')">å®Œå…¨ä¹¾ç‡¥</button>
                <button class="record-btn warning" onclick="submitRecord('å¹²ã—ãŸãŒå®Œå…¨ã«ã¯ä¹¾ã‹ã›ãªã‹ã£ãŸï¼ˆæ³£ï¼‰')">å¹²ã—ãŸãŒå®Œå…¨ã«ã¯ä¹¾ã‹ã›ãªã‹ã£ãŸï¼ˆæ³£ï¼‰</button>
                <button class="record-btn danger" onclick="submitRecord('ä¸­æ­¢')">ä¸­æ­¢</button>
            </div>
            <button onclick="closeRecordForm()" style="background: #6c757d; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>

        <div class="forecast-panel" id="forecastPanel">
            <div class="forecast-header">
                <h3 id="selectedSpotName">å¹²å ´ã‚’é¸æŠã—ã¦ãã ã•ã„</h3>
                <p id="selectedSpotLocation"></p>
            </div>

            <div id="autoUpdateStatus" style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px; font-size: 0.85rem; color: #666;">
                <span id="updateStatusText">è‡ªå‹•æ›´æ–°: åœæ­¢ä¸­</span>
                <span id="nextUpdateTime" style="display: block; margin-top: 3px;"></span>
            </div>

            <div class="forecast-tabs" id="forecastTabs" style="display: none;">
                <!-- Dynamic tabs will be inserted here -->
            </div>
            <!-- ç°¡æ˜“ã‚¨ãƒã‚°ãƒ©ãƒ è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div id="emagramSection" style="display: none; margin-bottom: 20px; background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <h3 style="color: #1e40af; border-bottom: 2px solid #3b82f6; padding-bottom: 10px; margin-top: 0;">
                    ğŸ“Š ç°¡æ˜“ã‚¨ãƒã‚°ãƒ©ãƒ  - æ°—æ¸©ãƒ»éœ²ç‚¹æ¸©åº¦é‰›ç›´ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
                </h3>
                <p style="color: #666; font-size: 14px; margin: 10px 0;">
                    å¤§æ°—ã®é‰›ç›´æ§‹é€ ã‚’ç¢ºèªï¼ˆå¤§æ°—å®‰å®šåº¦ãƒ»é€†è»¢å±¤ãƒ»é›²åº•é«˜åº¦ã®æ¨å®šï¼‰<br>
                    <span style="font-size: 12px; color: #999;">â€»ä½œæ¥­æ™‚é–“å¸¯ï¼ˆ6-18æ™‚ï¼‰ã®3æ™‚é–“åˆ»ã¿ãƒ‡ãƒ¼ã‚¿</span>
                </p>

                <!-- æ™‚åˆ»é¸æŠï¼ˆä½œæ¥­æ™‚é–“å¸¯6-18æ™‚ã€3æ™‚é–“åˆ»ã¿ï¼‰ -->
                <div style="margin: 15px 0;">
                    <label style="font-weight: bold; margin-right: 10px;">äºˆå ±æ™‚åˆ»ï¼ˆJSTï¼‰:</label>
                    <select id="emagramTimeSelect" onchange="loadEmagramData()" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                    </select>
                </div>

                <!-- Canvas for chart -->
                <div style="position: relative; height: 500px; margin: 20px 0;">
                    <canvas id="emagramCanvas"></canvas>
                </div>

                <!-- è§£èª¬æƒ…å ± -->
                <div id="emagramInfo" style="margin-top: 15px; padding: 10px; background: #f0f8ff; border-radius: 5px; font-size: 0.9rem;">
                    <div style="margin-bottom: 8px;">
                        <strong>ğŸ“Œ èª­ã¿æ–¹:</strong>
                    </div>
                    <ul style="margin: 5px 0; padding-left: 20px; line-height: 1.8;">
                        <li><span style="color: #dc3545; font-weight: bold;">èµ¤ç·š</span>: æ°—æ¸©ï¼ˆå³ã«é«˜æ¸©ï¼‰</li>
                        <li><span style="color: #007bff; font-weight: bold;">é’ç·š</span>: éœ²ç‚¹æ¸©åº¦ï¼ˆæ°—æ¸©ã«è¿‘ã„ã»ã©æ¹¿æ½¤ï¼‰</li>
                        <li><strong>æ°—æ¸©ã¨éœ²ç‚¹ãŒæ¥è¿‘</strong>: æ¹¿åº¦100%ã«è¿‘ã„ï¼ˆéœ§ãƒ»é›²ç™ºç”Ÿå±¤ï¼‰</li>
                        <li><strong>æ°—æ¸©ãŒä¸Šã«å‘ã‹ã£ã¦ä¸Šæ˜‡</strong>: é€†è»¢å±¤ï¼ˆéœ§ãƒ»æ±šæŸ“ç‰©è³ªã®é–‰ã˜è¾¼ã‚ï¼‰</li>
                        <li><strong>æ°—æ¸©ã¨éœ²ç‚¹ã®å·®ãŒå¤§ãã„</strong>: ä¹¾ç‡¥ã—ãŸç©ºæ°—ï¼ˆä¹¾ç‡¥ã«æœ‰åˆ©ï¼‰</li>
                    </ul>
                </div>
            </div>

            <!-- ç­‰å€¤ç·šãƒãƒƒãƒ—è¡¨ç¤ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div id="contourMapSection" style="display: none; margin-bottom: 20px; background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                <h3 style="margin-bottom: 10px; color: #2c3e50; font-size: 1.1rem;">æ°—è±¡è§£æãƒãƒƒãƒ—</h3>

                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button onclick="showContourMap('500hpa')" id="contour500Btn" style="flex: 1; padding: 8px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        500hPa æ¸¦åº¦
                    </button>
                    <button onclick="showContourMap('700hpa')" id="contour700Btn" style="flex: 1; padding: 8px; background: #e9ecef; color: #333; border: none; border-radius: 5px; cursor: pointer;">
                        700hPa é‰›ç›´æµ
                    </button>
                </div>

                <div id="contourMapContainer" style="text-align: center;">
                    <img id="contourMapImage" src="" alt="ç­‰å€¤ç·šãƒãƒƒãƒ—" style="max-width: 100%; border-radius: 5px;">
                    <p id="contourMapCaption" style="margin-top: 10px; font-size: 0.9rem; color: #7f8c8d;"></p>
                </div>

                <div id="calibrationInfo" style="margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-size: 0.85rem; color: #555;">
                    <strong>äºˆå ±è£œæ­£æƒ…å ±:</strong>
                    <div id="calibrationDetails"></div>
                </div>
            </div>

            <div id="forecastContent">
                <div class="loading">
                    <div class="spinner"></div>
                    äºˆå ±ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...
                </div>
                <!-- Dynamic daily forecast content will be inserted here -->
            </div>

            <div class="chart-container">
                <canvas id="forecastChart" width="350" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // åˆ©å°»å³¶ã®ä¸­å¿ƒåº§æ¨™
        const RISHIRI_CENTER = [45.178269, 141.228528];

        // ãƒãƒƒãƒ—åˆæœŸåŒ–
        const map = L.map('map').setView(RISHIRI_CENTER, 12);

        // èˆªç©ºå†™çœŸã‚¿ã‚¤ãƒ« (Google Satellite)
        L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            attribution: 'Â© Google',
            maxZoom: 20
        }).addTo(map);

        // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ã‚«ãƒ¼
        let selectedMarker = null;
        let selectedSpot = null;
        let forecastChart = null;

        // ãƒãƒ¼ã‚«ãƒ¼ç®¡ç†
        let allMarkers = [];
        let visibleMarkers = [];

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°çŠ¶æ…‹
        let currentFilters = {
            town: '',
            district: '',
            buraku: ''
        };

        // ãŠæ°—ã«å…¥ã‚Šç®¡ç†
        let favorites = JSON.parse(localStorage.getItem('hoshibaFavorites')) || [];

        // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç®¡ç†
        let feedbackData = JSON.parse(localStorage.getItem('forecastFeedback')) || {};

        // è‡ªå‹•æ›´æ–°ç®¡ç†
        let autoUpdateTimer = null;
        let lastUpdateTime = null;
        const UPDATE_INTERVAL = 60 * 60 * 1000; // 1æ™‚é–“

        // å¹²å ´ãƒ‡ãƒ¼ã‚¿ï¼ˆhoshiba_spots.csvã‹ã‚‰å…¨331ç®‡æ‰€ï¼‰
        // ãƒ‡ãƒ¼ã‚¿ä¸€è²«æ€§ã®ãŸã‚all_spots_array.jsã‹ã‚‰èª­ã¿è¾¼ã¿
        /* const hoshibaSpots = [
            { name: "H_1021_2473", lat: 45.1021947, lon: 141.247311, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡ä¸­" },
            { name: "H_1025_2483", lat: 45.1025111, lon: 141.2483481, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡ä¸­" },
            { name: "H_1034_2485", lat: 45.1034294, lon: 141.2485286, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡ä¸­" },
            { name: "H_1037_2486", lat: 45.1037247, lon: 141.2486332, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡ä¸­" },
            { name: "H_1040_2502", lat: 45.1040639, lon: 141.250253, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡ä¸­" },
            { name: "H_1048_2519", lat: 45.1048553, lon: 141.2519053, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡ä¸­" },
            { name: "H_1094_2687", lat: 45.1094479, lon: 141.268727, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1089_2701", lat: 45.1089406, lon: 141.2701461, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1098_2701", lat: 45.1098663, lon: 141.2701888, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1089_2721", lat: 45.1089222, lon: 141.2721856, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1093_2722", lat: 45.1093235, lon: 141.2722929, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1087_2725", lat: 45.1087049, lon: 141.2725681, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1103_2721", lat: 45.1103838, lon: 141.2721514, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1128_2736", lat: 45.1128726, lon: 141.2736647, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1109_2745", lat: 45.1109264, lon: 141.2745775, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1123_2744", lat: 45.1123653, lon: 141.2744747, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1110_2758", lat: 45.1110778, lon: 141.2758374, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1109_2760", lat: 45.1109604, lon: 141.276001, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1120_2760", lat: 45.1120335, lon: 141.276079, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1110_2765", lat: 45.1110214, lon: 141.2765827, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "å—æµœ" },
            { name: "H_1132_2845", lat: 45.1132552, lon: 141.28455, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ²¼æµ¦" },
            { name: "H_1135_2852", lat: 45.1135576, lon: 141.2852805, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ²¼æµ¦" },
            { name: "H_1131_2857", lat: 45.1131534, lon: 141.2857969, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ²¼æµ¦" },
            { name: "H_1127_2865", lat: 45.1127594, lon: 141.2865226, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ²¼æµ¦" },
            { name: "H_1142_2856", lat: 45.1142836, lon: 141.2856837, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ²¼æµ¦" },
            { name: "H_1144_2856", lat: 45.1144161, lon: 141.2856904, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ²¼æµ¦" },
            { name: "H_1150_2859", lat: 45.1150648, lon: 141.2859724, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ²¼æµ¦" },
            { name: "H_1152_2861", lat: 45.1152692, lon: 141.2861105, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ²¼æµ¦" },
            { name: "H_1158_2868", lat: 45.1158224, lon: 141.286849, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ²¼æµ¦" },
            { name: "H_1278_3025", lat: 45.1278291, lon: 141.3025525, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡‘å´" },
            { name: "H_1274_3032", lat: 45.1274206, lon: 141.3032061, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡‘å´" },
            { name: "H_1285_3022", lat: 45.1285684, lon: 141.3022085, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡‘å´" },
            { name: "H_1302_3047", lat: 45.1302484, lon: 141.3047225, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡‘å´" },
            { name: "H_1304_3063", lat: 45.1304074, lon: 141.3063238, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é‡‘å´" },
            { name: "H_1338_3064", lat: 45.1338215, lon: 141.3064824, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é¬¼è„‡" },
            { name: "H_1351_3093", lat: 45.1351708, lon: 141.3093172, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é¬¼è„‡" },
            { name: "H_1361_3088", lat: 45.1361111, lon: 141.3088355, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é¬¼è„‡" },
            { name: "H_1367_3096", lat: 45.1367493, lon: 141.3096145, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é¬¼è„‡" },
            { name: "H_1370_3094", lat: 45.137052, lon: 141.3094106, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é¬¼è„‡" },
            { name: "H_1359_3112", lat: 45.1359889, lon: 141.3112589, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é¬¼è„‡" },
            { name: "H_1442_3184", lat: 45.1442677, lon: 141.3184243, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ¸…å·" },
            { name: "H_1451_3204", lat: 45.1451173, lon: 141.3204306, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ¸…å·" },
            { name: "H_1524_3268", lat: 45.1524539, lon: 141.3268048, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "äºŒçŸ³" },
            { name: "H_1540_3282", lat: 45.1540826, lon: 141.328278, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "äºŒçŸ³" },
            { name: "H_1567_3281", lat: 45.1567282, lon: 141.3281503, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "äºŒçŸ³" },
            { name: "H_1742_3256", lat: 45.1742397, lon: 141.3256546, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "çŸ³å´" },
            { name: "H_1753_3251", lat: 45.1753987, lon: 141.3251336, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "çŸ³å´" },
            { name: "H_1778_3244", lat: 45.1778217, lon: 141.324457, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "çŸ³å´" },
            { name: "H_1893_3209", lat: 45.1893588, lon: 141.3209405, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ—­æµœ" },
            { name: "H_1940_3177", lat: 45.1940268, lon: 141.317736, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ—­æµœ" },
            { name: "H_1946_3173", lat: 45.1946346, lon: 141.3173819, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ—­æµœ" },
            { name: "H_1947_3177", lat: 45.1947542, lon: 141.3177935, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ—­æµœ" },
            { name: "H_1950_3176", lat: 45.1950056, lon: 141.3176728, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ—­æµœ" },
            { name: "H_1953_3176", lat: 45.1953685, lon: 141.3176299, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "æ—­æµœ" },
            { name: "H_1980_3109", lat: 45.1980472, lon: 141.3109215, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é°Šæ³Š" },
            { name: "H_2031_3110", lat: 45.2031365, lon: 141.3110767, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é°Šæ³Š" },
            { name: "H_2040_3104", lat: 45.2040524, lon: 141.3104559, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é°Šæ³Š" },
            { name: "H_2042_3110", lat: 45.2042659, lon: 141.3110326, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é°Šæ³Š" },
            { name: "H_2079_3079", lat: 45.2079224, lon: 141.3079776, town: "åˆ©å°»å¯Œå£«ç”º", district: "é¬¼è„‡", buraku: "é°Šæ³Š" },
            { name: "H_2194_2962", lat: 45.2194176, lon: 141.2962013, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2193_2959", lat: 45.2193194, lon: 141.2959867, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2201_2935", lat: 45.2201345, lon: 141.2935349, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2204_2938", lat: 45.2204618, lon: 141.2938303, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2199_2928", lat: 45.219963, lon: 141.2928647, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2210_2904", lat: 45.2210151, lon: 141.2904494, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2210_2890", lat: 45.2210388, lon: 141.2890304, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2214_2893", lat: 45.221457, lon: 141.2893312, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2212_2878", lat: 45.2212342, lon: 141.2878744, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2219_2868", lat: 45.2219079, lon: 141.2868433, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2220_2862", lat: 45.2220439, lon: 141.286221, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2215_2856", lat: 45.2215376, lon: 141.2856577, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2218_2852", lat: 45.2218248, lon: 141.2852661, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2221_2854", lat: 45.2221875, lon: 141.2854324, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2224_2845", lat: 45.2224066, lon: 141.2845634, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2227_2836", lat: 45.2227795, lon: 141.2836497, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2227_2825", lat: 45.2227253, lon: 141.2825291, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2239_2811", lat: 45.2239435, lon: 141.2811209, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2237_2808", lat: 45.2237319, lon: 141.2808312, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2247_2802", lat: 45.2247828, lon: 141.2802683, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2256_2798", lat: 45.2256531, lon: 141.2798945, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é›„å¿ å¿—å†…" },
            { name: "H_2285_2795", lat: 45.2285744, lon: 141.2795595, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2291_2795", lat: 45.2291147, lon: 141.2795005, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2286_2789", lat: 45.2286084, lon: 141.2789346, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2289_2791", lat: 45.2289031, lon: 141.2791304, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2293_2788", lat: 45.2293262, lon: 141.2788997, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2290_2784", lat: 45.2290731, lon: 141.2784035, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2303_2784", lat: 45.2303186, lon: 141.2784865, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2310_2788", lat: 45.2310321, lon: 141.2788517, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2306_2783", lat: 45.2306511, lon: 141.2783337, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2310_2782", lat: 45.2310828, lon: 141.2782263, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2301_2772", lat: 45.230104, lon: 141.27726, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2306_2774", lat: 45.2306823, lon: 141.2774055, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2324_2761", lat: 45.2324163, lon: 141.276199, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2335_2755", lat: 45.2335589, lon: 141.2755405, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2328_2750", lat: 45.2328752, lon: 141.2750577, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2295_2716", lat: 45.2295769, lon: 141.2716298, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2336_2735", lat: 45.2336033, lon: 141.273556, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2333_2728", lat: 45.2333984, lon: 141.2728951, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2334_2721", lat: 45.2334664, lon: 141.2721763, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2339_2724", lat: 45.2339094, lon: 141.2724089, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2338_2721", lat: 45.2338328, lon: 141.2721387, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2336_2709", lat: 45.2336399, lon: 141.2709148, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2304_2689", lat: 45.2304117, lon: 141.2689928, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2321_2696", lat: 45.2321359, lon: 141.2696453, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2335_2702", lat: 45.2335381, lon: 141.2702816, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2343_2707", lat: 45.2343497, lon: 141.2707242, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2312_2687", lat: 45.2312126, lon: 141.2687881, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2333_2698", lat: 45.2333266, lon: 141.2698847, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2335_2699", lat: 45.2335683, lon: 141.2699598, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2341_2689", lat: 45.2341459, lon: 141.2689975, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2349_2692", lat: 45.2349392, lon: 141.2692443, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2320_2676", lat: 45.2320281, lon: 141.2676805, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2345_2687", lat: 45.2345161, lon: 141.2687186, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2311_2669", lat: 45.2311673, lon: 141.2669597, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2334_2676", lat: 45.2334409, lon: 141.2676698, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "é‡å¡š" },
            { name: "H_2308_2619", lat: 45.230855, lon: 141.2619475, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2336_2570", lat: 45.2336527, lon: 141.2570902, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2341_2459", lat: 45.2341015, lon: 141.2459467, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2337_2440", lat: 45.2337844, lon: 141.2440412, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2339_2435", lat: 45.2339622, lon: 141.2435604, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2337_2418", lat: 45.2337851, lon: 141.2418753, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2340_2417", lat: 45.2340382, lon: 141.2417412, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2343_2407", lat: 45.2343285, lon: 141.2407067, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2344_2393", lat: 45.2344229, lon: 141.2393335, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2342_2390", lat: 45.2342601, lon: 141.2390011, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2339_2388", lat: 45.2339941, lon: 141.238894, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2339_2382", lat: 45.2339095, lon: 141.2382436, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2331_2380", lat: 45.2331577, lon: 141.2380102, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2337_2369", lat: 45.2337791, lon: 141.2369709, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2448_2304", lat: 45.24477126204745, lon: 141.23042285442355, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2449_2271", lat: 45.2449474, lon: 141.2271061, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2451_2270", lat: 45.245108, lon: 141.2270471, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¹¾å†…" },
            { name: "H_2449_2267", lat: 45.244904, lon: 141.2267682, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¸¯ç”º" },
            { name: "H_2393_2280", lat: 45.2393215, lon: 141.2280094, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¸¯ç”º" },
            { name: "H_2446_2262", lat: 45.2446982, lon: 141.2262474, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ¸¯ç”º" },
            { name: "H_2463_2219", lat: 45.2463148, lon: 141.2219816, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ „ç”º" },
            { name: "H_2464_2216", lat: 45.2464662, lon: 141.2216058, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ „ç”º" },
            { name: "H_2467_2209", lat: 45.2467619, lon: 141.2209986, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ „ç”º" },
            { name: "H_2477_2203", lat: 45.2477271, lon: 141.2203331, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ „ç”º" },
            { name: "H_2480_2198", lat: 45.2480376, lon: 141.2198462, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ „ç”º" },
            { name: "H_2478_2195", lat: 45.2478847, lon: 141.2195726, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ „ç”º" },
            { name: "H_2479_2191", lat: 45.24793, lon: 141.2191086, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æ „ç”º" },
            { name: "H_2579_1966", lat: 45.2579463, lon: 141.1966851, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¯Œå£«å²¬" },
            { name: "H_2575_1968", lat: 45.257528, lon: 141.1968466, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¯Œå£«å²¬" },
            { name: "H_2579_1957", lat: 45.2579451, lon: 141.195735, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¯Œå£«å²¬" },
            { name: "H_2581_1945", lat: 45.258163, lon: 141.1945494, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¯Œå£«å²¬" },
            { name: "H_2581_1934", lat: 45.2581336, lon: 141.1934075, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¯Œå£«å²¬" },
            { name: "H_2579_1933", lat: 45.2579048, lon: 141.1933233, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¯Œå£«å²¬" },
            { name: "H_2575_1930", lat: 45.2575895, lon: 141.1930146, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2574_1919", lat: 45.2574384, lon: 141.1919687, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2565_1899", lat: 45.2565726, lon: 141.1899583, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2565_1893", lat: 45.2565726, lon: 141.1893602, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2563_1893", lat: 45.2563989, lon: 141.1893575, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2512_1861", lat: 45.2512927, lon: 141.186103, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2507_1861", lat: 45.2507977, lon: 141.1861938, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2517_1848", lat: 45.2517003, lon: 141.1848425, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2494_1848", lat: 45.2494955, lon: 141.1848312, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2516_1829", lat: 45.2516839, lon: 141.1829666, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2476_1852", lat: 45.2476831, lon: 141.1852532, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2475_1845", lat: 45.2475868, lon: 141.1845035, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "æœ¬æ³Š" },
            { name: "H_2466_1826", lat: 45.2466719, lon: 141.1826188, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2455_1813", lat: 45.2455728, lon: 141.1813367, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2462_1785", lat: 45.2462307, lon: 141.17855, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2455_1786", lat: 45.2455802, lon: 141.1786554, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2449_1787", lat: 45.2449797, lon: 141.1787923, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2468_1766", lat: 45.2468489, lon: 141.176613, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2454_1779", lat: 45.2454745, lon: 141.1779728, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2446_1774", lat: 45.2446706, lon: 141.1774097, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2439_1772", lat: 45.2439473, lon: 141.1772333, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2434_1764", lat: 45.2434053, lon: 141.1764709, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2426_1759", lat: 45.2426844, lon: 141.1759649, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2414_1760", lat: 45.241472, lon: 141.1760937, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2422_1746", lat: 45.242235, lon: 141.174656, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2426_1741", lat: 45.2426801, lon: 141.1741546, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2297_1543", lat: 45.2297761, lon: 141.1543565, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2292_1551", lat: 45.229217, lon: 141.1551159, town: "åˆ©å°»å¯Œå£«ç”º", district: "é´›æ³Š", buraku: "å¤§ç£¯" },
            { name: "H_2183_1381", lat: 45.2183318, lon: 141.1381607, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ „æµœ" },
            { name: "H_2182_1377", lat: 45.2182693, lon: 141.1377479, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ „æµœ" },
            { name: "H_2176_1383", lat: 45.2176465, lon: 141.1383282, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ „æµœ" },
            { name: "H_2162_1369", lat: 45.2162989, lon: 141.1369268, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ „æµœ" },
            { name: "H_2153_1377", lat: 45.2153768, lon: 141.137775, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ „æµœ" },
            { name: "H_2150_1362", lat: 45.215014, lon: 141.1362997, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ „æµœ" },
            { name: "H_2148_1356", lat: 45.2148553, lon: 141.1356077, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ „æµœ" },
            { name: "H_2139_1335", lat: 45.2139627, lon: 141.1335752, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ „æµœ" },
            { name: "H_2088_1443", lat: 45.2088707, lon: 141.1443995, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2110_1346", lat: 45.2110922, lon: 141.1346602, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2080_1451", lat: 45.208048, lon: 141.1451738, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2095_1370", lat: 45.2095628, lon: 141.1370219, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2095_1365", lat: 45.2095666, lon: 141.1365163, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2091_1377", lat: 45.2091917, lon: 141.1377542, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2073_1446", lat: 45.2073413, lon: 141.1446213, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2089_1368", lat: 45.2089394, lon: 141.1368919, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2064_1420", lat: 45.2064953, lon: 141.1420567, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2077_1364", lat: 45.2077046, lon: 141.1364899, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2065_1375", lat: 45.2065728, lon: 141.137565, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2065_1369", lat: 45.2065164, lon: 141.1369002, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2052_1384", lat: 45.2052096, lon: 141.1384087, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2030_1392", lat: 45.2030471, lon: 141.1392327, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2020_1404", lat: 45.2020959, lon: 141.140491, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_2011_1417", lat: 45.201169, lon: 141.141782, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ–°æ¹Š" },
            { name: "H_1998_1383", lat: 45.1998289, lon: 141.1383242, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¨®å¯Œç”º" },
            { name: "H_1883_1394", lat: 45.1883009, lon: 141.1394494, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "å¯Œé‡ãƒ»æ—¥å‡ºç”ºãƒ»ç·‘ç”ºãƒ»æœ¬ç”ºãƒ»å¯Œå£«è¦‹ç”º" },
            { name: "H_1885_1351", lat: 45.1885151, lon: 141.1351124, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "å¯Œé‡ãƒ»æ—¥å‡ºç”ºãƒ»ç·‘ç”ºãƒ»æœ¬ç”ºãƒ»å¯Œå£«è¦‹ç”º" },
            { name: "H_1857_1317", lat: 45.1857184, lon: 141.131719, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "å¯Œé‡ãƒ»æ—¥å‡ºç”ºãƒ»ç·‘ç”ºãƒ»æœ¬ç”ºãƒ»å¯Œå£«è¦‹ç”º" },
            { name: "H_1845_1337", lat: 45.1845217, lon: 141.1337514, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "å¯Œé‡ãƒ»æ—¥å‡ºç”ºãƒ»ç·‘ç”ºãƒ»æœ¬ç”ºãƒ»å¯Œå£«è¦‹ç”º" },
            { name: "H_1838_1349", lat: 45.1838904, lon: 141.134998, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "å¯Œé‡ãƒ»æ—¥å‡ºç”ºãƒ»ç·‘ç”ºãƒ»æœ¬ç”ºãƒ»å¯Œå£«è¦‹ç”º" },
            { name: "H_1836_1371", lat: 45.1836457, lon: 141.1371968, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "å¯Œé‡ãƒ»æ—¥å‡ºç”ºãƒ»ç·‘ç”ºãƒ»æœ¬ç”ºãƒ»å¯Œå£«è¦‹ç”º" },
            { name: "H_1835_1363", lat: 45.1835834, lon: 141.1363493, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "å¯Œé‡ãƒ»æ—¥å‡ºç”ºãƒ»ç·‘ç”ºãƒ»æœ¬ç”ºãƒ»å¯Œå£«è¦‹ç”º" },
            { name: "H_1835_1367", lat: 45.1835456, lon: 141.1367007, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "å¯Œé‡ãƒ»æ—¥å‡ºç”ºãƒ»ç·‘ç”ºãƒ»æœ¬ç”ºãƒ»å¯Œå£«è¦‹ç”º" },
            { name: "H_1834_1386", lat: 45.1834255, lon: 141.1386249, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "å¯Œé‡ãƒ»æ—¥å‡ºç”ºãƒ»ç·‘ç”ºãƒ»æœ¬ç”ºãƒ»å¯Œå£«è¦‹ç”º" },
            { name: "H_1818_1416", lat: 45.1818894, lon: 141.141604, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1817_1402", lat: 45.1817422, lon: 141.1402608, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1811_1399", lat: 45.1811051, lon: 141.1399778, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1804_1404", lat: 45.1804171, lon: 141.1404971, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1799_1392", lat: 45.1799133, lon: 141.1392124, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1798_1396", lat: 45.1798377, lon: 141.139647, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1795_1395", lat: 45.1795258, lon: 141.1395881, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1795_1393", lat: 45.1795069, lon: 141.1393681, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1790_1377", lat: 45.1790034, lon: 141.1377481, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1788_1372", lat: 45.1788408, lon: 141.1372921, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1782_1394", lat: 45.1782154, lon: 141.1394976, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1762_1377", lat: 45.1762629, lon: 141.1377278, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "æ³‰ç”º" },
            { name: "H_1745_1387", lat: 45.1745589, lon: 141.1387238, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1725_1392", lat: 45.1725647, lon: 141.1392606, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1723_1388", lat: 45.1723075, lon: 141.1388261, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1721_1390", lat: 45.1721789, lon: 141.1390943, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1719_1390", lat: 45.1719407, lon: 141.1390031, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1704_1384", lat: 45.1704874, lon: 141.1384103, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1698_1385", lat: 45.1698969, lon: 141.1385708, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1695_1397", lat: 45.1695078, lon: 141.1397705, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1642_1430", lat: 45.1642297, lon: 141.1430654, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1637_1420", lat: 45.163794, lon: 141.1420934, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1629_1421", lat: 45.1629892, lon: 141.1421148, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1630_1426", lat: 45.1630233, lon: 141.1426459, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1631_1434", lat: 45.1631035, lon: 141.1434784, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1624_1426", lat: 45.1624446, lon: 141.1426244, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1613_1450", lat: 45.1613739, lon: 141.1450036, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "ç¥å±…" },
            { name: "H_1544_1510", lat: 45.1544086, lon: 141.1510617, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "è˜­æ³Š" },
            { name: "H_1517_1528", lat: 45.151713, lon: 141.152844, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "è˜­æ³Š" },
            { name: "H_1490_1564", lat: 45.1490644, lon: 141.1564134, town: "åˆ©å°»ç”º", district: "æ²“å½¢", buraku: "è˜­æ³Š" },
            { name: "H_1488_1568", lat: 45.1488286, lon: 141.1568409, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1484_1578", lat: 45.1484215, lon: 141.1578882, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1386_1658", lat: 45.1386527, lon: 141.165883, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1376_1662", lat: 45.1376793, lon: 141.166274, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1370_1684", lat: 45.1370722, lon: 141.168404, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1364_1676", lat: 45.1364546, lon: 141.1676095, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1362_1681", lat: 45.1362881, lon: 141.1681353, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1364_1688", lat: 45.1364516, lon: 141.1688868, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1360_1691", lat: 45.1360732, lon: 141.1691658, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1356_1687", lat: 45.1356264, lon: 141.1687017, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1352_1690", lat: 45.1352972, lon: 141.1690933, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ä¹…é€£" },
            { name: "H_1279_1806", lat: 45.1279996, lon: 141.180658, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "é•·æµœ" },
            { name: "H_1275_1824", lat: 45.1275998, lon: 141.1824476, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "é•·æµœ" },
            { name: "H_1274_1829", lat: 45.1274371, lon: 141.182984, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "é•·æµœ" },
            { name: "H_1266_1851", lat: 45.1266709, lon: 141.18514, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "é•·æµœ" },
            { name: "H_1264_1862", lat: 45.1264901, lon: 141.1862968, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "é•·æµœ" },
            { name: "H_1261_1871", lat: 45.1261867, lon: 141.1871998, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "é•·æµœ" },
            { name: "H_1254_1910", lat: 45.1254663, lon: 141.1910171, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1201_1983", lat: 45.12012, lon: 141.1983058, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1202_1987", lat: 45.1202539, lon: 141.1987064, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1190_2001", lat: 45.1190237, lon: 141.2001839, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1187_2006", lat: 45.1187323, lon: 141.2006667, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1179_2012", lat: 45.1179306, lon: 141.2012737, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1187_2021", lat: 45.1187228, lon: 141.2021983, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1174_2017", lat: 45.1174726, lon: 141.2017458, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1193_2032", lat: 45.1193133, lon: 141.2032926, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1168_2021", lat: 45.1168902, lon: 141.202176, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1163_2023", lat: 45.1163905, lon: 141.2023047, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1159_2022", lat: 45.1159627, lon: 141.2022511, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1156_2027", lat: 45.1156135, lon: 141.2027696, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "ç¥ç£¯" },
            { name: "H_1176_2048", lat: 45.1176023, lon: 141.2048161, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1157_2040", lat: 45.1157831, lon: 141.2040999, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1155_2039", lat: 45.115509, lon: 141.2039961, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1154_2050", lat: 45.1154598, lon: 141.2050234, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1152_2053", lat: 45.115263, lon: 141.2053721, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1150_2053", lat: 45.1150699, lon: 141.205356, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1176_2068", lat: 45.1176175, lon: 141.2068331, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1141_2080", lat: 45.1141486, lon: 141.2080556, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1138_2086", lat: 45.1138382, lon: 141.208667, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1135_2085", lat: 45.1135127, lon: 141.2085382, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1132_2088", lat: 45.1132505, lon: 141.2088686, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1131_2104", lat: 45.1131045, lon: 141.2104698, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1121_2106", lat: 45.1121695, lon: 141.2106951, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1125_2109", lat: 45.1125215, lon: 141.2109204, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æ”¿æ³Š" },
            { name: "H_1109_2141", lat: 45.1109702, lon: 141.2141438, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1112_2148", lat: 45.1112163, lon: 141.214868, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1107_2152", lat: 45.1107242, lon: 141.2152221, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1105_2154", lat: 45.1105336, lon: 141.2154636, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1113_2168", lat: 45.1113909, lon: 141.2168461, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1099_2183", lat: 45.1099756, lon: 141.218347, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1071_2182", lat: 45.1071109, lon: 141.2182966, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1080_2187", lat: 45.1080022, lon: 141.2187599, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1076_2188", lat: 45.1076646, lon: 141.218891, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1072_2189", lat: 45.1072161, lon: 141.2189003, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1068_2198", lat: 45.1068639, lon: 141.2198209, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "æœ¬ç”º" },
            { name: "H_1067_2201", lat: 45.1067276, lon: 141.2201696, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1064_2209", lat: 45.1064436, lon: 141.2209367, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1079_2225", lat: 45.1079586, lon: 141.2225588, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1064_2224", lat: 45.1064667, lon: 141.2224071, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1064_2238", lat: 45.1064311, lon: 141.2238985, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1061_2255", lat: 45.1061591, lon: 141.2255371, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1059_2261", lat: 45.1059702, lon: 141.2261239, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1064_2264", lat: 45.1064435, lon: 141.2264297, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1058_2266", lat: 45.105861, lon: 141.2266559, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1058_2269", lat: 45.1058005, lon: 141.2269617, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1054_2274", lat: 45.1054103, lon: 141.2274857, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å…ƒæ‘" },
            { name: "H_1052_2278", lat: 45.1052855, lon: 141.2278468, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0999_2282", lat: 45.099954, lon: 141.228227, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0996_2286", lat: 45.0996921, lon: 141.228644, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_1013_2289", lat: 45.1013171, lon: 141.2289152, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_1021_2294", lat: 45.1021501, lon: 141.2294408, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_1002_2305", lat: 45.1002115, lon: 141.2305065, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_1000_2307", lat: 45.100083, lon: 141.2307556, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0999_2310", lat: 45.0999335, lon: 141.2310079, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_1014_2312", lat: 45.1014286, lon: 141.2312722, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0993_2312", lat: 45.0993577, lon: 141.2312092, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0985_2332", lat: 45.098564, lon: 141.2332933, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0989_2335", lat: 45.0989786, lon: 141.2335938, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0991_2343", lat: 45.0991319, lon: 141.234371, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0991_2351", lat: 45.09916, lon: 141.2351819, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0988_2353", lat: 45.0988753, lon: 141.2353402, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0982_2358", lat: 45.0982545, lon: 141.2358986, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0978_2363", lat: 45.0978959, lon: 141.2363079, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0983_2369", lat: 45.0983261, lon: 141.2369949, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0986_2371", lat: 45.0986909, lon: 141.237183, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0983_2378", lat: 45.0983485, lon: 141.2378509, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0976_2378", lat: 45.0976072, lon: 141.2378178, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0980_2384", lat: 45.0980579, lon: 141.2384079, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_1047_2387", lat: 45.104712, lon: 141.2387548, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0988_2393", lat: 45.0988451, lon: 141.2393708, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" },
            { name: "H_0988_2398", lat: 45.0988214, lon: 141.2398858, town: "åˆ©å°»ç”º", district: "ä»™æ³•å¿—", buraku: "å¾¡å´" }
        ]; */

        // å¹²å ´ãƒãƒ¼ã‚«ãƒ¼ã‚’åœ°å›³ã«è¿½åŠ 
        function addHoshibaMarkers() {
            // æ—¢å­˜ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªã‚¢
            allMarkers.forEach(markerData => {
                map.removeLayer(markerData.marker);
            });
            allMarkers = [];

            // hoshibaSpotså¤‰æ•°ã®æœ‰åŠ¹æ€§ç¢ºèª
            if (typeof hoshibaSpots === 'undefined') {
                console.error('hoshibaSpots is not defined. Trying to load from API...');
                loadSpotsFromAPI();
                return;
            }

            // all_spots_array.jsã‹ã‚‰èª­ã¿è¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
            hoshibaSpots.forEach((spot, index) => {
                const isFavorite = favorites.includes(index);
                const marker = L.circleMarker([spot.lat, spot.lon], {
                    radius: 8,
                    fillColor: isFavorite ? '#28a745' : '#667eea',
                    color: 'white',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.8
                }).addTo(map);

                // ãƒãƒ¼ã‚«ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’é…åˆ—ã«ä¿å­˜
                allMarkers.push({
                    marker: marker,
                    spot: spot,
                    index: index,
                    visible: true
                });

                marker.bindPopup(`
                    <div style="text-align: center; padding: 10px;">
                        <strong>${spot.name}</strong><br>
                        <span style="color: #666;">${spot.town} ${spot.district}</span><br>
                        <button onclick="selectSpot(${index})" style="
                            background: #667eea;
                            color: white;
                            border: none;
                            padding: 8px 15px;
                            border-radius: 5px;
                            cursor: pointer;
                            margin: 5px;
                        ">7æ—¥é–“äºˆå ±ã‚’è¡¨ç¤º</button>
                        <button onclick="toggleFavorite(${index})" style="
                            background: #28a745;
                            color: white;
                            border: none;
                            padding: 8px 15px;
                            border-radius: 5px;
                            cursor: pointer;
                            margin: 5px;
                        ">ãŠæ°—ã«å…¥ã‚Šç™»éŒ²</button>
                        <button onclick="deleteSpot(${index})" style="
                            background: #dc3545;
                            color: white;
                            border: none;
                            padding: 8px 15px;
                            border-radius: 5px;
                            cursor: pointer;
                            margin: 5px;
                        ">ğŸ—‘ï¸ å¹²å ´ã‚’å‰Šé™¤</button>
                        <button onclick="console.log('Record button clicked for index:', ${index}); showRecordForm(${index})" style="
                            background: #17a2b8;
                            color: white;
                            border: none;
                            padding: 8px 15px;
                            border-radius: 5px;
                            cursor: pointer;
                            margin: 5px;
                        ">ğŸ“ è¨˜éŒ²ã‚’å…¥åŠ›</button>
                    </div>
                `);

                marker.on('click', () => selectSpot(index));
                spot.marker = marker;
            });
        }

        // éšå±¤ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–¢æ•°
        function filterByTown() {
            const townSelect = document.getElementById('townSelect');
            const selectedTown = townSelect.value;

            currentFilters.town = selectedTown;
            currentFilters.district = '';
            currentFilters.buraku = '';

            // åœ°åŒºã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’æ›´æ–°
            updateDistrictOptions(selectedTown);

            // ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            applyFilters();
            updateBreadcrumb();
            updateStats();
        }

        function filterByDistrict() {
            const districtSelect = document.getElementById('districtSelect');
            const selectedDistrict = districtSelect.value;

            currentFilters.district = selectedDistrict;
            currentFilters.buraku = '';

            // éƒ¨è½ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’æ›´æ–°
            updateBurakuOptions(currentFilters.town, selectedDistrict);

            // ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            applyFilters();
            updateBreadcrumb();
            updateStats();
        }

        function filterByBuraku() {
            const burakuSelect = document.getElementById('burakuSelect');
            const selectedBuraku = burakuSelect.value;

            currentFilters.buraku = selectedBuraku;

            // ãƒãƒ¼ã‚«ãƒ¼ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
            applyFilters();
            updateBreadcrumb();
            updateStats();
        }

        function resetFilters() {
            currentFilters = { town: '', district: '', buraku: '' };

            // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('townSelect').value = '';
            document.getElementById('districtSelect').value = '';
            document.getElementById('burakuSelect').value = '';

            // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éš ã™
            document.getElementById('districtSection').style.display = 'none';
            document.getElementById('burakuSection').style.display = 'none';

            // å…¨ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤º
            showAllMarkers();
            updateBreadcrumb();
            updateStats();

            // å…¨ä½“è¡¨ç¤ºã«ã‚ºãƒ¼ãƒ 
            map.setView(RISHIRI_CENTER, 12);
        }

        function updateDistrictOptions(selectedTown) {
            const districtSelect = document.getElementById('districtSelect');
            const districtSection = document.getElementById('districtSection');
            const burakuSection = document.getElementById('burakuSection');

            districtSelect.innerHTML = '<option value="">-- åœ°åŒºã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>';

            if (selectedTown) {
                // é¸æŠã•ã‚ŒãŸç”ºã®åœ°åŒºã‚’å–å¾—
                const districts = [...new Set(
                    hoshibaSpots
                        .filter(spot => spot.town === selectedTown)
                        .map(spot => spot.district)
                )].sort();

                districts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });

                districtSection.style.display = 'block';
                burakuSection.style.display = 'none';
            } else {
                districtSection.style.display = 'none';
                burakuSection.style.display = 'none';
            }
        }

        function updateBurakuOptions(selectedTown, selectedDistrict) {
            const burakuSelect = document.getElementById('burakuSelect');
            const burakuSection = document.getElementById('burakuSection');

            burakuSelect.innerHTML = '<option value="">-- éƒ¨è½ã‚’é¸æŠã—ã¦ãã ã•ã„ --</option>';

            if (selectedTown && selectedDistrict) {
                // é¸æŠã•ã‚ŒãŸç”ºãƒ»åœ°åŒºã®éƒ¨è½ã‚’å–å¾—
                const burakus = [...new Set(
                    hoshibaSpots
                        .filter(spot => spot.town === selectedTown && spot.district === selectedDistrict)
                        .map(spot => spot.buraku)
                )].sort();

                burakus.forEach(buraku => {
                    const option = document.createElement('option');
                    option.value = buraku;
                    option.textContent = buraku;
                    burakuSelect.appendChild(option);
                });

                burakuSection.style.display = 'block';
            } else {
                burakuSection.style.display = 'none';
            }
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å®Ÿè¡Œ
        function applyFilters() {
            let visibleCount = 0;
            const filteredMarkers = [];

            allMarkers.forEach(markerData => {
                const { marker, spot, index } = markerData;
                let shouldShow = true;

                // ç”ºãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                if (currentFilters.town && spot.town !== currentFilters.town) {
                    shouldShow = false;
                }

                // åœ°åŒºãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                if (currentFilters.district && spot.district !== currentFilters.district) {
                    shouldShow = false;
                }

                // éƒ¨è½ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                if (currentFilters.buraku && spot.buraku !== currentFilters.buraku) {
                    shouldShow = false;
                }

                if (shouldShow) {
                    if (!map.hasLayer(marker)) {
                        map.addLayer(marker);
                    }
                    markerData.visible = true;
                    filteredMarkers.push(markerData);
                    visibleCount++;
                } else {
                    if (map.hasLayer(marker)) {
                        map.removeLayer(marker);
                    }
                    markerData.visible = false;
                }
            });

            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸç¯„å›²ã«ã‚ºãƒ¼ãƒ 
            if (filteredMarkers.length > 0) {
                zoomToMarkers(filteredMarkers);
            }

            return visibleCount;
        }

        // æŒ‡å®šã•ã‚ŒãŸãƒãƒ¼ã‚«ãƒ¼ã®ç¯„å›²ã«ã‚ºãƒ¼ãƒ 
        function zoomToMarkers(markerData) {
            if (markerData.length === 0) return;

            const latLngs = markerData.map(data => [data.spot.lat, data.spot.lon]);
            const group = L.latLngBounds(latLngs);

            // é©åˆ‡ãªãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã§ã‚ºãƒ¼ãƒ 
            map.fitBounds(group, {
                padding: [50, 50],
                maxZoom: 16
            });
        }

        // å…¨ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤º
        function showAllMarkers() {
            allMarkers.forEach(markerData => {
                const { marker } = markerData;
                if (!map.hasLayer(marker)) {
                    map.addLayer(marker);
                }
                markerData.visible = true;
            });
        }

        // ãƒ‘ãƒ³ããšãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ›´æ–°
        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('filterBreadcrumb');
            let html = '<span class="breadcrumb-item" onclick="resetFilters()">å…¨ã‚¨ãƒªã‚¢</span>';

            if (currentFilters.town) {
                html += '<span class="breadcrumb-separator"> > </span>';
                html += `<span class="breadcrumb-item" onclick="filterToTown('${currentFilters.town}')">${currentFilters.town}</span>`;
            }

            if (currentFilters.district) {
                html += '<span class="breadcrumb-separator"> > </span>';
                html += `<span class="breadcrumb-item" onclick="filterToDistrict('${currentFilters.town}', '${currentFilters.district}')">${currentFilters.district}</span>`;
            }

            if (currentFilters.buraku) {
                html += '<span class="breadcrumb-separator"> > </span>';
                html += `<span class="breadcrumb-item">${currentFilters.buraku}</span>`;
            }

            breadcrumb.innerHTML = html;
        }

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            const visibleCount = allMarkers.filter(m => m.visible).length;
            const statsElement = document.getElementById('filterStats');
            statsElement.textContent = `è¡¨ç¤ºä¸­: ${visibleCount}ç®‡æ‰€ã®å¹²å ´`;
        }

        // ãƒ‘ãƒ³ããšãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰ç”ºãƒ¬ãƒ™ãƒ«ã«ãƒ•ã‚£ãƒ«ã‚¿
        function filterToTown(town) {
            currentFilters = { town: town, district: '', buraku: '' };
            document.getElementById('townSelect').value = town;
            updateDistrictOptions(town);
            applyFilters();
            updateBreadcrumb();
            updateStats();
        }

        // ãƒ‘ãƒ³ããšãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰åœ°åŒºãƒ¬ãƒ™ãƒ«ã«ãƒ•ã‚£ãƒ«ã‚¿
        function filterToDistrict(town, district) {
            currentFilters = { town: town, district: district, buraku: '' };
            document.getElementById('townSelect').value = town;
            document.getElementById('districtSelect').value = district;
            updateDistrictOptions(town);
            updateBurakuOptions(town, district);
            applyFilters();
            updateBreadcrumb();
            updateStats();
        }

        // å¹²å ´é¸æŠå‡¦ç†
        async function selectSpot(index) {
            const spot = hoshibaSpots[index];

            // å‰ã®é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ
            if (selectedMarker) {
                selectedMarker.setStyle({
                    fillColor: '#667eea',
                    radius: 8
                });
            }

            // æ–°ã—ã„é¸æŠã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
            selectedMarker = spot.marker;
            selectedMarker.setStyle({
                fillColor: '#ff6b6b',
                radius: 12
            });

            selectedSpot = spot;

            // ãƒ‘ãƒãƒ«è¡¨ç¤º
            const panel = document.getElementById('forecastPanel');
            panel.classList.add('active');

            // ãƒ˜ãƒƒãƒ€ãƒ¼æ›´æ–°
            document.getElementById('selectedSpotName').textContent = spot.name;
            document.getElementById('selectedSpotLocation').textContent = `${spot.town} ${spot.district} ${spot.buraku}`;

            // äºˆå ±ãƒ‡ãƒ¼ã‚¿å–å¾—
            await loadForecastData(spot);

            // è‡ªå‹•æ›´æ–°é–‹å§‹
            startAutoUpdate();
        }

        // äºˆå ±ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨è¡¨ç¤º
        async function loadForecastData(spot) {
            const forecastContent = document.getElementById('forecastContent');
            const forecastTabs = document.getElementById('forecastTabs');

            forecastContent.innerHTML = '<div class="loading"><div class="spinner"></div>äºˆå ±ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...</div>';
            forecastTabs.style.display = 'none';

            try {
                // Enhanced API call
                const response = await fetch(`/api/forecast?lat=${spot.lat}&lon=${spot.lon}`);
                const data = await response.json();

                if (data.status === 'success') {
                    displayEnhancedForecast(data.forecasts);
                    updateChart(data.forecasts);
                    lastUpdateTime = new Date();
                    updateAutoUpdateStatus();
                } else {
                    forecastContent.innerHTML = '<div style="color: red; text-align: center; padding: 20px;">äºˆå ±ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
                }
            } catch (error) {
                console.error('Forecast fetch error:', error);
                forecastContent.innerHTML = '<div style="color: red; text-align: center; padding: 20px;">ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>';
            }
        }

        // äºˆå ±è¡¨ç¤º
        function displayForecast(forecasts) {
            const forecastContent = document.getElementById('forecastContent');
            let html = '';

            forecasts.forEach(forecast => {
                const date = new Date(forecast.date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;
                const dayStr = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][date.getDay()];

                html += `
                    <div class="forecast-item">
                        <div class="forecast-date">${dateStr} (${dayStr})</div>
                        <div class="forecast-data">
                            <div class="data-item">
                                <span>æœ€é«˜æ°—æ¸©:</span>
                                <span>${forecast.temperature_max}Â°C</span>
                            </div>
                            <div class="data-item">
                                <span>æ¹¿åº¦:</span>
                                <span>${forecast.humidity}%</span>
                            </div>
                            <div class="data-item">
                                <span>é¢¨é€Ÿ:</span>
                                <span>${forecast.wind_speed}m/s</span>
                            </div>
                            <div class="data-item">
                                <span>é™æ°´é‡:</span>
                                <span>${forecast.precipitation}mm</span>
                            </div>
                            <div class="data-item expert-only">
                                <span>æ°—åœ§:</span>
                                <span>${forecast.pressure || '1013'}hPa</span>
                            </div>
                            <div class="data-item">
                                <span>é¢¨å‘:</span>
                                <span>${forecast.daily_summary && forecast.daily_summary.wind_direction ? getRishiriWindDetails(forecast.daily_summary.wind_direction).name + ' (' + getRishiriWindDetails(forecast.daily_summary.wind_direction).cardinal16 + ')' : '--'}</span>
                            </div>
                            <div class="data-item expert-only">
                                <span>ç´«å¤–ç·šæŒ‡æ•°:</span>
                                <span>${forecast.uv_index || '5'}</span>
                            </div>
                            <div class="data-item expert-only">
                                <span>é›²é‡:</span>
                                <span>${forecast.cloud_cover || '30'}%</span>
                            </div>
                        </div>
                        <div class="suitability ${forecast.suitability}">
                            ä¹¾ç‡¥é©æ€§: ${getSuitabilityText(forecast.suitability)} (${forecast.drying_score}ç‚¹)
                        </div>
                        <div class="schedule-recommendation" style="margin-top: 10px; padding: 8px; background: rgba(102, 126, 234, 0.1); border-radius: 5px; font-size: 0.85rem;">
                            <strong>ğŸ•’ æ¨å¥¨ä½œæ¥­æ™‚é–“:</strong>
                            <div id="workSchedule_${forecast.date}" style="margin-top: 5px; color: #333;"></div>
                        </div>
                        <div class="feedback-section">
                            <small style="color: #666; margin-bottom: 5px; display: block;">å®Ÿéš›ã®ä¹¾ç‡¥çŠ¶æ³ã‚’ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯:</small>
                            <div class="feedback-buttons">
                                <button onclick="submitFeedback('${forecast.date}', 'excellent')" class="feedback-btn excellent">éå¸¸ã«è‰¯ã„</button>
                                <button onclick="submitFeedback('${forecast.date}', 'good')" class="feedback-btn good">è‰¯ã„</button>
                                <button onclick="submitFeedback('${forecast.date}', 'fair')" class="feedback-btn fair">æ™®é€š</button>
                                <button onclick="submitFeedback('${forecast.date}', 'poor')" class="feedback-btn poor">æ‚ªã„</button>
                            </div>
                        </div>
                    </div>
                `;
            });

            forecastContent.innerHTML = html;

            // ä½œæ¥­ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨ˆç®—
            forecasts.forEach(forecast => {
                calculateWorkSchedule(forecast);
            });
        }

        // Enhanced forecast display with tabs and hourly details
        function displayEnhancedForecast(forecasts) {
            const forecastContent = document.getElementById('forecastContent');
            const forecastTabs = document.getElementById('forecastTabs');

            // Create tabs
            let tabsHtml = '';
            forecasts.forEach((forecast, index) => {
                const date = new Date(forecast.date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;
                const dayStr = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][date.getDay()];
                const isActive = index === 0 ? 'active' : '';
                const reliabilityClass = getReliabilityClass(forecast.reliability);

                const dayLabel = index === 0 ? 'ä»Šæ—¥' : index === 1 ? 'æ˜æ—¥' : `${index}æ—¥å¾Œ`;

                tabsHtml += `
                    <div class="forecast-tab ${isActive}" onclick="showForecastDay(${index})" data-day="${index}">
                        ${dayLabel}<br>
                        <small>${dateStr}(${dayStr})</small><br>
                        <span class="reliability-badge ${reliabilityClass}">${forecast.reliability.accuracy}%</span>
                    </div>
                `;
            });

            forecastTabs.innerHTML = tabsHtml;
            forecastTabs.style.display = 'flex';

            // Create content for each day
            let contentHtml = '';
            forecasts.forEach((forecast, index) => {
                const date = new Date(forecast.date);
                const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;
                const dayStr = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'][date.getDay()];
                const isActive = index === 0 ? 'active' : '';
                const reliabilityClass = getReliabilityClass(forecast.reliability);

                const dayLabel2 = index === 0 ? 'ä»Šæ—¥' : index === 1 ? 'æ˜æ—¥' : `${index}æ—¥å¾Œ`;

                contentHtml += `
                    <div class="forecast-content ${isActive}" id="forecastDay${index}">
                        <div class="forecast-item">
                            <div class="forecast-date">${dateStr} (${dayStr}) - ${dayLabel2}</div>

                            <div class="reliability-badge ${reliabilityClass}" style="margin-bottom: 15px;">
                                ä¿¡é ¼åº¦: ${forecast.reliability.accuracy}% (${forecast.reliability.confidence}) - ${forecast.reliability.usage}
                            </div>

                            <div class="forecast-data">
                                <div class="data-item">
                                    <span>æœ€é«˜æ°—æ¸©:</span>
                                    <span>${forecast.daily_summary.temperature_max.toFixed(1)}Â°C</span>
                                </div>
                                <div class="data-item">
                                    <span>æœ€ä½æ°—æ¸©:</span>
                                    <span>${forecast.daily_summary.temperature_min.toFixed(1)}Â°C</span>
                                </div>
                                <div class="data-item">
                                    <span>å¹³å‡æ¹¿åº¦:</span>
                                    <span>${forecast.daily_summary.humidity.toFixed(1)}%</span>
                                </div>
                                <div class="data-item">
                                    <span>æœ€å¤§é¢¨é€Ÿ:</span>
                                    <span>${forecast.daily_summary.wind_speed.toFixed(1)}m/s</span>
                                </div>
                                <div class="data-item">
                                    <span>é™æ°´é‡:</span>
                                    <span>${forecast.daily_summary.precipitation.toFixed(1)}mm</span>
                                </div>
                            </div>

                            <div class="suitability ${forecast.daily_summary.suitability}">
                                ä¹¾ç‡¥é©æ€§: ${getSuitabilityText(forecast.daily_summary.suitability)} (${forecast.daily_summary.drying_score}ç‚¹)
                            </div>

                            <div class="schedule-recommendation" style="margin: 15px 0; padding: 10px; background: rgba(102, 126, 234, 0.1); border-radius: 5px;">
                                <strong>ğŸ•’ äºˆæ¸¬ä¹¾ç‡¥æ™‚é–“:</strong> ${forecast.daily_summary.estimated_drying_time}
                            </div>

                            ${generateHourlyDetails(forecast.hourly_details, forecast.day_number)}

                            <div class="feedback-section">
                                <small style="color: #666; margin-bottom: 5px; display: block;">å®Ÿéš›ã®ä¹¾ç‡¥çŠ¶æ³ã‚’ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯:</small>
                                <div class="feedback-buttons">
                                    <button onclick="submitFeedback('${forecast.date}', 'excellent')" class="feedback-btn excellent">éå¸¸ã«è‰¯ã„</button>
                                    <button onclick="submitFeedback('${forecast.date}', 'good')" class="feedback-btn good">è‰¯ã„</button>
                                    <button onclick="submitFeedback('${forecast.date}', 'fair')" class="feedback-btn fair">æ™®é€š</button>
                                    <button onclick="submitFeedback('${forecast.date}', 'poor')" class="feedback-btn poor">æ‚ªã„</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            forecastContent.innerHTML = contentHtml;
        }

        function generateHourlyDetails(hourlyData, dayIndex = 0) {
            if (!hourlyData || hourlyData.length === 0) {
                return '<div class="hourly-section"><h4>æ™‚é–“åˆ¥è©³ç´°ãƒ‡ãƒ¼ã‚¿ãªã—</h4></div>';
            }

            const tabId = `hourly-view-${dayIndex}`;

            let html = `
                <div class="hourly-section">
                    <h4>ğŸ“Š æ™‚é–“åˆ¥è©³ç´° (4:00-16:00)</h4>

                    <!-- ä¸€èˆ¬/å°‚é–€å®¶å‘ã‘ã‚¿ãƒ– -->
                    <div class="view-mode-tabs">
                        <button class="view-mode-tab active" onclick="switchViewMode('${tabId}', 'general')">
                            ğŸŒ¤ï¸ ä¸€èˆ¬æ¼å¸«å‘ã‘
                        </button>
                        <button class="view-mode-tab" onclick="switchViewMode('${tabId}', 'expert')">
                            ğŸŒªï¸ æ°—è±¡å°‚é–€å®¶å‘ã‘
                        </button>
                    </div>

                    <div class="hourly-table-container">
                        <table class="hourly-table" id="${tabId}">
                            <thead>
                                <tr>
                                    <th>æ™‚åˆ»</th>
            `;

            // æ™‚åˆ»åˆ—ã®ç”Ÿæˆ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    html += `<th>${hour.time}</th>`;
                }
            });

            html += `
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ä¸€èˆ¬æ¼å¸«å‘ã‘é …ç›® -->
                                <tr class="general-row">
                                    <td class="time-cell">ğŸŒ¡ï¸ æ°—æ¸©(Â°C)</td>
            `;

            // æ°—æ¸©è¡Œ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    html += `<td>${hour.temperature ? hour.temperature.toFixed(1) : '--'}</td>`;
                }
            });

            html += `
                                </tr>
                                <tr class="general-row">
                                    <td class="time-cell">ğŸ’§ æ¹¿åº¦(%)</td>
            `;

            // æ¹¿åº¦è¡Œ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    html += `<td>${hour.humidity ? hour.humidity.toFixed(0) : '--'}</td>`;
                }
            });

            html += `
                                </tr>
                                <tr class="general-row">
                                    <td class="time-cell">ğŸ’¨ é¢¨é€Ÿ(m/s)</td>
            `;

            // é¢¨é€Ÿè¡Œ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    html += `<td>${hour.wind_speed ? hour.wind_speed.toFixed(1) : '--'}</td>`;
                }
            });

            html += `
                                </tr>
                                <tr class="general-row">
                                    <td class="time-cell">ğŸŒ¬ï¸ é¢¨å‘</td>
            `;

            // é¢¨å‘è¡Œ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    const windDetails = hour.wind_direction ? getRishiriWindDetails(hour.wind_direction) : null;
                    const windName = windDetails ? `${windDetails.name} (${windDetails.cardinal16})` : '--';
                    html += `<td title="${windDetails ? windDetails.cardinal : ''}">${windName}</td>`;
                }
            });

            html += `
                                </tr>
                                <tr class="general-row">
                                    <td class="time-cell">â˜€ï¸ æ—¥å°„(W/mÂ²)</td>
            `;

            // æ—¥å°„é‡è¡Œ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    html += `<td>${hour.solar_radiation ? Math.round(hour.solar_radiation) : '--'}</td>`;
                }
            });

            html += `
                                </tr>

                                <!-- å°‚é–€å®¶å‘ã‘é …ç›® -->
                                <tr class="expert-row">
                                    <td class="time-cell">â˜ï¸ é›²é‡(%)</td>
            `;

            // é›²é‡è¡Œ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    html += `<td>${hour.cloud_cover ? hour.cloud_cover.toFixed(0) : '--'}</td>`;
                }
            });

            html += `
                                </tr>
                                <tr class="expert-row">
                                    <td class="time-cell">ğŸ“ é¢¨å‘-å±±é ‚è§’å·®(Â°)</td>
            `;

            // é¢¨å‘-å±±é ‚è§’åº¦å·®è¡Œ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    html += `<td>${hour.wind_mountain_angle_diff !== undefined && hour.wind_mountain_angle_diff !== null ? hour.wind_mountain_angle_diff.toFixed(1) : '--'}</td>`;
                }
            });

            html += `
                                </tr>
                                <tr class="expert-row">
                                    <td class="time-cell">â¬†ï¸ é‰›ç›´é€Ÿåº¦(Pa/s)</td>
            `;

            // é‰›ç›´pé€Ÿåº¦è¡Œ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    html += `<td>${hour.vertical_p_velocity !== undefined ? hour.vertical_p_velocity.toFixed(3) : '--'}</td>`;
                }
            });

            html += `
                                </tr>
                                <tr class="expert-row">
                                    <td class="time-cell">ğŸ“Š SSI</td>
            `;

            // SSIè¡Œ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    const ssiValue = hour.ssi !== undefined && hour.ssi !== null ? hour.ssi.toFixed(1) : '--';
                    const ssiCategory = hour.ssi !== undefined && hour.ssi !== null ? getSSICategory(hour.ssi) : '';
                    html += `<td title="${ssiCategory}">${ssiValue}</td>`;
                }
            });

            html += `
                                </tr>
                                <tr class="expert-row">
                                    <td class="time-cell">ğŸŒ¡ï¸ ç›¸å½“æ¸©ä½(K)</td>
            `;

            // ç›¸å½“æ¸©ä½è¡Œ
            hourlyData.forEach(hour => {
                if (hour.temperature !== null) {
                    html += `<td>${hour.equivalent_potential_temperature !== undefined && hour.equivalent_potential_temperature !== null ? hour.equivalent_potential_temperature.toFixed(1) : '--'}</td>`;
                }
            });

            html += `
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            return html;
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function switchViewMode(tableId, mode) {
            const table = document.getElementById(tableId);
            const tabs = document.querySelectorAll(`button[onclick*="${tableId}"]`);

            // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            tabs.forEach(tab => {
                if (tab.onclick.toString().includes(`'${mode}'`)) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });

            // ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡¨ç¤ºåˆ‡æ›¿
            if (mode === 'expert') {
                table.classList.add('show-expert');
            } else {
                table.classList.remove('show-expert');
            }
        }

        function getReliabilityClass(reliability) {
            if (reliability.accuracy >= 85) return 'reliability-high';
            if (reliability.accuracy >= 70) return 'reliability-medium';
            return 'reliability-low';
        }

        let currentForecastDay = 0;  // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹äºˆå ±æ—¥

        function showForecastDay(dayIndex) {
            console.log('showForecastDay called with dayIndex:', dayIndex);

            // Hide all content
            document.querySelectorAll('.forecast-content').forEach(content => {
                content.classList.remove('active');
            });

            // Hide all tabs
            document.querySelectorAll('.forecast-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected content and tab
            const selectedContent = document.getElementById(`forecastDay${dayIndex}`);
            const selectedTab = document.querySelector(`.forecast-tab[data-day="${dayIndex}"]`);

            if (selectedContent) selectedContent.classList.add('active');
            if (selectedTab) selectedTab.classList.add('active');

            // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹æ—¥ã‚’ä¿å­˜
            currentForecastDay = dayIndex;
            console.log('currentForecastDay updated to:', currentForecastDay);

            // ã‚¨ãƒã‚°ãƒ©ãƒ æ™‚åˆ»é¸æŠè‚¢ã‚’æ›´æ–°
            updateEmagramTimeOptions();
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«é–¢æ•°ã‚’å…¬é–‹ï¼ˆonclick ã‹ã‚‰å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«ï¼‰
        window.showForecastDay = showForecastDay;

        // ä½œæ¥­ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æœ€é©åŒ–
        function calculateWorkSchedule(forecast) {
            const scheduleElement = document.getElementById(`workSchedule_${forecast.date}`);
            if (!scheduleElement) return;

            let recommendations = [];

            // ä¹¾ç‡¥é©æ€§ã«åŸºã¥ãæ¨å¥¨æ™‚é–“å¸¯
            if (forecast.drying_score >= 8) {
                recommendations.push('ğŸŒŸ çµ‚æ—¥ä½œæ¥­æœ€é© (6:00-18:00)');
            } else if (forecast.drying_score >= 6) {
                // é¢¨é€Ÿã¨æ¹¿åº¦ã‚’è€ƒæ…®
                const windSpeed = forecast.wind_speed || 5;
                const humidity = forecast.humidity || 70;

                if (windSpeed > 3 && humidity < 70) {
                    recommendations.push('â˜€ï¸ åˆå‰ä¸­æ¨å¥¨ (8:00-12:00)');
                    recommendations.push('ğŸŒ¤ï¸ åˆå¾Œã‚‚è‰¯å¥½ (13:00-17:00)');
                } else if (windSpeed > 3) {
                    recommendations.push('ğŸŒ¬ï¸ é¢¨å¼·æ™‚é–“å¸¯ (10:00-15:00)');
                } else {
                    recommendations.push('â° çŸ­æ™‚é–“ä½œæ¥­ (10:00-14:00)');
                }
            } else if (forecast.drying_score >= 4) {
                recommendations.push('âš ï¸ é™å®šçš„ä½œæ¥­ (11:00-13:00)');
                if (forecast.precipitation < 1) {
                    recommendations.push('ğŸ’§ é›¨é–“ã‚’åˆ©ç”¨');
                }
            } else {
                recommendations.push('âŒ ä½œæ¥­éæ¨å¥¨');
                if (forecast.precipitation > 5) {
                    recommendations.push('ğŸŒ§ï¸ é›¨å¤©ä½œæ¥­åœæ­¢');
                }
            }

            // æ°—æ¸©ã«ã‚ˆã‚‹èª¿æ•´
            const temp = forecast.temperature_max || 20;
            if (temp > 25) {
                recommendations.push('ğŸŒ¡ï¸ é«˜æ¸©æ³¨æ„ (æ—©æœãƒ»å¤•æ–¹æ¨å¥¨)');
            } else if (temp < 10) {
                recommendations.push('ğŸ§¥ ä½æ¸©æ³¨æ„ (æ—¥ä¸­æ¨å¥¨)');
            }

            scheduleElement.innerHTML = recommendations.join('<br>');
        }

        // é©æ€§ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›
        function getSuitabilityText(suitability) {
            const suitabilityMap = {
                'excellent': 'éå¸¸ã«è‰¯ã„',
                'good': 'è‰¯ã„',
                'fair': 'æ™®é€š',
                'poor': 'æ‚ªã„'
            };
            return suitabilityMap[suitability] || suitability;
        }

        function getSSICategory(ssi) {
            if (ssi === null || ssi === undefined) {
                return '--';
            }
            if (ssi >= 3) {
                return 'å®‰å®š';
            } else if (ssi >= 0) {
                return 'ä¸­æ€§';
            } else if (ssi >= -3) {
                return 'ã‚„ã‚„ä¸å®‰å®š';
            } else {
                return 'ä¸å®‰å®š';
            }
        }

        // ãƒãƒ£ãƒ¼ãƒˆæ›´æ–°
        function updateChart(forecasts) {
            const ctx = document.getElementById('forecastChart').getContext('2d');

            if (forecastChart) {
                forecastChart.destroy();
            }

            const labels = forecasts.map(f => {
                const date = new Date(f.date);
                return `${date.getMonth() + 1}/${date.getDate()}`;
            });

            forecastChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ä¹¾ç‡¥é©æ€§ã‚¹ã‚³ã‚¢',
                            data: forecasts.map(f => f.daily_summary.drying_score),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'æœ€é«˜æ°—æ¸© (Â°C)',
                            data: forecasts.map(f => f.daily_summary.temperature_max),
                            borderColor: '#ff6b6b',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            fill: false,
                            tension: 0.3,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '7æ—¥é–“ä¹¾ç‡¥é©æ€§äºˆå ±'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'é©æ€§ã‚¹ã‚³ã‚¢'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'æ°—æ¸© (Â°C)'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });
        }

        // ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½
        function toggleFavorite(index) {
            const favoriteIndex = favorites.indexOf(index);
            if (favoriteIndex === -1) {
                // ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ 
                favorites.push(index);
            } else {
                // ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤
                favorites.splice(favoriteIndex, 1);
            }

            localStorage.setItem('hoshibaFavorites', JSON.stringify(favorites));
            refreshMarkers();
            updateFavoritesList();
        }

        function refreshMarkers() {
            map.eachLayer((layer) => {
                if (layer instanceof L.CircleMarker) {
                    map.removeLayer(layer);
                }
            });
            addHoshibaMarkers();
        }

        function showFavorites() {
            const favoritesList = document.getElementById('favoritesList');
            if (favoritesList.style.display === 'none') {
                favoritesList.style.display = 'block';
                updateFavoritesList();
            } else {
                favoritesList.style.display = 'none';
            }
        }

        function updateFavoritesList() {
            const content = document.getElementById('favoritesContent');

            if (favorites.length === 0) {
                content.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">ãŠæ°—ã«å…¥ã‚Šã®å¹²å ´ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            let html = '';
            favorites.forEach(index => {
                const spot = hoshibaSpots[index];
                html += `
                    <div class="favorite-item" onclick="selectSpot(${index})">
                        <div>
                            <strong>${spot.name}</strong><br>
                            <small style="color: #666;">${spot.town} ${spot.district}</small>
                        </div>
                        <button onclick="event.stopPropagation(); toggleFavorite(${index})"
                                style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">
                            å‰Šé™¤
                        </button>
                    </div>
                `;
            });

            content.innerHTML = html;
        }

        function clearAllFavorites() {
            if (confirm('ã™ã¹ã¦ã®ãŠæ°—ã«å…¥ã‚Šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                favorites = [];
                localStorage.setItem('hoshibaFavorites', JSON.stringify(favorites));
                refreshMarkers();
                updateFavoritesList();
            }
        }

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿æ©Ÿèƒ½

        // è‡ªå‹•æ›´æ–°æ©Ÿèƒ½
        function startAutoUpdate() {
            if (autoUpdateTimer) {
                clearInterval(autoUpdateTimer);
            }

            if (!selectedSpot) {
                console.log('selectedSpot is not set, cannot start auto-update');
                return;
            }

            autoUpdateTimer = setInterval(() => {
                if (selectedSpot) {
                    console.log('è‡ªå‹•æ›´æ–°ã‚’å®Ÿè¡Œä¸­...');
                    loadForecastData(selectedSpot);
                }
            }, UPDATE_INTERVAL);

            // ã‚¿ã‚¤ãƒãƒ¼è¨­å®šå¾Œã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
            setTimeout(() => {
                updateAutoUpdateStatus();
            }, 100);
        }

        function stopAutoUpdate() {
            if (autoUpdateTimer) {
                clearInterval(autoUpdateTimer);
                autoUpdateTimer = null;
            }
            updateAutoUpdateStatus();
        }

        function updateAutoUpdateStatus() {
            const statusText = document.getElementById('updateStatusText');
            const nextUpdateTime = document.getElementById('nextUpdateTime');

            if (autoUpdateTimer && selectedSpot) {
                statusText.textContent = 'è‡ªå‹•æ›´æ–°: æœ‰åŠ¹';
                if (lastUpdateTime) {
                    const nextUpdate = new Date(lastUpdateTime.getTime() + UPDATE_INTERVAL);
                    nextUpdateTime.textContent = `æ¬¡å›æ›´æ–°: ${nextUpdate.toLocaleTimeString()}`;
                    nextUpdateTime.style.display = 'block';
                } else {
                    nextUpdateTime.style.display = 'none';
                }
            } else {
                statusText.textContent = 'è‡ªå‹•æ›´æ–°: åœæ­¢ä¸­';
                nextUpdateTime.style.display = 'none';
            }
        }

        // ãƒšãƒ¼ã‚¸è¡¨ç¤ºçŠ¶æ…‹ã®ç›£è¦–
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible' && selectedSpot) {
                // ãƒšãƒ¼ã‚¸ãŒå†è¡¨ç¤ºã•ã‚ŒãŸæ™‚ã«æ›´æ–°ãƒã‚§ãƒƒã‚¯
                if (lastUpdateTime && (new Date() - lastUpdateTime) > UPDATE_INTERVAL * 0.8) {
                    loadForecastData(selectedSpot);
                }
            }
        });

        // APIã‹ã‚‰ã‚¹ãƒãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€é–¢æ•°ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
        async function loadSpotsFromAPI() {
            try {
                console.log('Loading spots data from CSV API...');
                const response = await fetch('/api/spots');
                const data = await response.json();

                if (data && Array.isArray(data)) {
                    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦è¨­å®š
                    window.hoshibaSpots = data;
                    console.log(`Loaded ${data.length} spots from API`);

                    // H_1174_2017ã®æ‰€å±ç¢ºèª
                    const spot = data.find(s => s.name === 'H_1174_2017');
                    if (spot) {
                        console.log(`H_1174_2017: ${spot.town}, ${spot.district}, ${spot.buraku}`);
                    }

                    // ãƒãƒ¼ã‚«ãƒ¼ã‚’å†æç”»
                    addHoshibaMarkers();
                } else {
                    console.error('Failed to load spots data from API');
                }
            } catch (error) {
                console.error('Error loading spots from API:', error);
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦éœ²å‡ºï¼ˆHTML onchangeã‹ã‚‰å‘¼ã³å‡ºã—å¯èƒ½ã«ã™ã‚‹ï¼‰
        window.filterByTown = filterByTown;
        window.filterByDistrict = filterByDistrict;
        window.filterByBuraku = filterByBuraku;

        // ========================================
        // é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ  (ä»•æ§˜æ›¸ lines 335-341)
        // ========================================

        let notificationData = JSON.parse(localStorage.getItem('hoshibaNotificationData')) || {
            enabled: false,
            offDays: [],
            seasonStart: null,
            seasonEnd: null
        };

        // é€šçŸ¥è¨­å®šã®åˆæœŸåŒ–
        function initializeNotifications() {
            const checkbox = document.getElementById('notificationEnabled');
            const settingsDiv = document.getElementById('notificationSettings');

            // ä¿å­˜æ¸ˆã¿è¨­å®šã‚’å¾©å…ƒ
            checkbox.checked = notificationData.enabled;
            settingsDiv.style.display = notificationData.enabled ? 'block' : 'none';

            if (notificationData.seasonStart) {
                document.getElementById('seasonStartDate').value = notificationData.seasonStart;
            }
            if (notificationData.seasonEnd) {
                document.getElementById('seasonEndDate').value = notificationData.seasonEnd;
            }

            updateNotificationSpotsList();
            updateOffDaysList();

            // PWAé€šçŸ¥æ¨©é™ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            if (notificationData.enabled && 'Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('é€šçŸ¥æ¨©é™ãŒè¨±å¯ã•ã‚Œã¾ã—ãŸ');
                    }
                });
            }
        }

        function toggleNotifications() {
            const checkbox = document.getElementById('notificationEnabled');
            const settingsDiv = document.getElementById('notificationSettings');

            notificationData.enabled = checkbox.checked;
            settingsDiv.style.display = checkbox.checked ? 'block' : 'none';

            // PWAé€šçŸ¥æ¨©é™ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            if (checkbox.checked && 'Notification' in window) {
                if (Notification.permission === 'default') {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            alert('é€šçŸ¥ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸã€‚æ¯æ—¥åˆå¾Œ4æ™‚ã«ãŠæ°—ã«å…¥ã‚Šå¹²å ´ã®äºˆå ±ã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚');
                            scheduleNextNotification();
                        } else {
                            alert('é€šçŸ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®é€šçŸ¥è¨±å¯ãŒå¿…è¦ã§ã™ã€‚');
                            checkbox.checked = false;
                            notificationData.enabled = false;
                            settingsDiv.style.display = 'none';
                        }
                    });
                } else if (Notification.permission === 'granted') {
                    scheduleNextNotification();
                }
            }

            saveNotificationData();
            updateNotificationSpotsList();
        }

        function updateNotificationSpotsList() {
            const listDiv = document.getElementById('notificationSpotsList');

            if (favorites.length === 0) {
                listDiv.innerHTML = '<p style="color: #999;">ãŠæ°—ã«å…¥ã‚Šã«å¹²å ´ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>';
            } else {
                const spotNames = favorites.map(index => hoshibaSpots[index].name).join(', ');
                listDiv.innerHTML = `<p>é€šçŸ¥å¯¾è±¡: ${favorites.length}ç®‡æ‰€</p><p style="color: #666; font-size: 0.8rem;">${spotNames}</p>`;
            }
        }

        function addOffDay() {
            const dateInput = document.getElementById('offDayDate');
            const date = dateInput.value;

            if (!date) {
                alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            if (!notificationData.offDays.includes(date)) {
                notificationData.offDays.push(date);
                notificationData.offDays.sort();
                saveNotificationData();
                updateOffDaysList();
                dateInput.value = '';
            } else {
                alert('ã“ã®æ—¥ä»˜ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
            }
        }

        function removeOffDay(date) {
            notificationData.offDays = notificationData.offDays.filter(d => d !== date);
            saveNotificationData();
            updateOffDaysList();
        }

        function updateOffDaysList() {
            const listDiv = document.getElementById('offDaysList');

            if (notificationData.offDays.length === 0) {
                listDiv.innerHTML = '<p style="color: #999;">æ²–æ­¢ã‚æ—¥ã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>';
            } else {
                let html = '<div style="display: flex; flex-direction: column; gap: 5px;">';
                notificationData.offDays.forEach(date => {
                    html += `<div style="display: flex; justify-content: space-between; align-items: center; padding: 5px; background: white; border-radius: 3px;">
                        <span>${date}</span>
                        <button onclick="removeOffDay('${date}')" style="padding: 3px 8px; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 0.8rem;">å‰Šé™¤</button>
                    </div>`;
                });
                html += '</div>';
                listDiv.innerHTML = html;
            }
        }

        function saveSeasonDates() {
            const startDate = document.getElementById('seasonStartDate').value;
            const endDate = document.getElementById('seasonEndDate').value;

            if (!startDate || !endDate) {
                alert('é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã®ä¸¡æ–¹ã‚’è¨­å®šã—ã¦ãã ã•ã„');
                return;
            }

            if (startDate > endDate) {
                alert('é–‹å§‹æ—¥ã¯çµ‚äº†æ—¥ã‚ˆã‚Šå‰ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
                return;
            }

            notificationData.seasonStart = startDate;
            notificationData.seasonEnd = endDate;
            saveNotificationData();
            alert('æ¼æœŸãŒä¿å­˜ã•ã‚Œã¾ã—ãŸ');
        }

        function saveNotificationData() {
            localStorage.setItem('hoshibaNotificationData', JSON.stringify(notificationData));
        }

        // åˆå¾Œ4æ™‚ã®é€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°
        function scheduleNextNotification() {
            if (!notificationData.enabled) return;

            const now = new Date();
            const today4PM = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 16, 0, 0);

            // ä»Šæ—¥ã®4æ™‚ãŒéãã¦ã„ã‚Œã°æ˜æ—¥ã®4æ™‚ã«è¨­å®š
            if (now > today4PM) {
                today4PM.setDate(today4PM.getDate() + 1);
            }

            const timeUntilNotification = today4PM - now;

            setTimeout(() => {
                checkAndSendNotification();
                // æ¬¡å›ã®é€šçŸ¥ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ24æ™‚é–“å¾Œï¼‰
                scheduleNextNotification();
            }, timeUntilNotification);

            console.log(`æ¬¡å›é€šçŸ¥äºˆå®š: ${today4PM.toLocaleString()}`);
        }

        function checkAndSendNotification() {
            // æ¼æœŸãƒã‚§ãƒƒã‚¯
            const today = new Date().toISOString().split('T')[0];

            if (notificationData.seasonStart && today < notificationData.seasonStart) {
                console.log('æ¼æœŸå‰ã®ãŸã‚é€šçŸ¥ã‚’ã‚¹ã‚­ãƒƒãƒ—');
                return;
            }

            if (notificationData.seasonEnd && today > notificationData.seasonEnd) {
                console.log('æ¼æœŸå¾Œã®ãŸã‚é€šçŸ¥ã‚’ã‚¹ã‚­ãƒƒãƒ—');
                return;
            }

            // æ²–æ­¢ã‚æ—¥ãƒã‚§ãƒƒã‚¯ï¼ˆæ˜æ—¥ãŒæ²–æ­¢ã‚ãªã‚‰ä»Šæ—¥ã¯é€šçŸ¥ã—ãªã„ï¼‰
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];

            if (notificationData.offDays.includes(tomorrowStr)) {
                console.log('æ˜æ—¥ã¯æ²–æ­¢ã‚ã®ãŸã‚é€šçŸ¥ã‚’ã‚¹ã‚­ãƒƒãƒ—');
                return;
            }

            // ãŠæ°—ã«å…¥ã‚Šå¹²å ´ã®äºˆå ±ã‚’å–å¾—ã—ã¦é€šçŸ¥
            if (favorites.length > 0 && 'Notification' in window && Notification.permission === 'granted') {
                sendForecastNotifications();
            }
        }

        async function sendForecastNotifications() {
            for (const favoriteIndex of favorites) {
                const spot = hoshibaSpots[favoriteIndex];

                try {
                    const response = await fetch(`/api/forecast?lat=${spot.lat}&lon=${spot.lon}&name=${encodeURIComponent(spot.name)}`);
                    const data = await response.json();

                    if (data.forecast && data.forecast.length > 0) {
                        const tomorrow = data.forecast[0]; // 1æ—¥å¾Œã®äºˆå ±

                        const title = `ğŸŒŠ ${spot.name} æ˜æ—¥ã®äºˆå ±`;
                        const body = `é™æ°´: ${tomorrow.precipitation}mm, æ¹¿åº¦: ${tomorrow.min_humidity}%, é¢¨é€Ÿ: ${tomorrow.avg_wind}m/s\nåˆ¤å®š: ${tomorrow.recommendation}`;

                        new Notification(title, {
                            body: body,
                            icon: '/static/icon-192x192.png',
                            badge: '/static/badge-72x72.png',
                            tag: `forecast-${spot.name}`,
                            requireInteraction: false
                        });
                    }
                } catch (error) {
                    console.error(`é€šçŸ¥é€ä¿¡ã‚¨ãƒ©ãƒ¼ (${spot.name}):`, error);
                }

                // é€šçŸ¥é–“éš”ã‚’ç©ºã‘ã‚‹ï¼ˆé€£ç¶šé€ä¿¡ã‚’é¿ã‘ã‚‹ï¼‰
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }

        window.toggleNotifications = toggleNotifications;
        window.addOffDay = addOffDay;
        window.removeOffDay = removeOffDay;
        window.saveSeasonDates = saveSeasonDates;

        // ========================================
        // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åŒæœŸæ©Ÿèƒ½ (ä»•æ§˜æ›¸ lines 41-44)
        // ========================================

        let pendingSyncData = JSON.parse(localStorage.getItem('pendingSyncData')) || [];

        function updateConnectionStatus() {
            const statusDiv = document.getElementById('connectionStatus');
            const iconSpan = document.getElementById('statusIcon');
            const textSpan = document.getElementById('statusText');

            if (navigator.onLine) {
                statusDiv.style.background = '#d4edda';
                statusDiv.style.color = '#155724';
                iconSpan.textContent = 'ğŸŒ';
                textSpan.textContent = 'ã‚ªãƒ³ãƒ©ã‚¤ãƒ³';

                // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¾©å¸°æ™‚ã«ä¿ç•™ä¸­ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸ
                if (pendingSyncData.length > 0) {
                    syncPendingData();
                }
            } else {
                statusDiv.style.background = '#f8d7da';
                statusDiv.style.color = '#721c24';
                iconSpan.textContent = 'ğŸ“´';
                textSpan.textContent = `ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ (${pendingSyncData.length}ä»¶ä¿å­˜ä¸­)`;
            }
        }

        async function syncPendingData() {
            if (pendingSyncData.length === 0) return;

            const textSpan = document.getElementById('statusText');
            textSpan.textContent = `åŒæœŸä¸­... (${pendingSyncData.length}ä»¶)`;

            let successCount = 0;
            let failedData = [];

            for (const dataItem of pendingSyncData) {
                try {
                    const response = await fetch(dataItem.endpoint, {
                        method: dataItem.method || 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dataItem.data)
                    });

                    if (response.ok) {
                        successCount++;
                        console.log(`åŒæœŸæˆåŠŸ: ${dataItem.endpoint}`);
                    } else {
                        failedData.push(dataItem);
                        console.error(`åŒæœŸå¤±æ•—: ${dataItem.endpoint}`, response.status);
                    }
                } catch (error) {
                    failedData.push(dataItem);
                    console.error(`åŒæœŸã‚¨ãƒ©ãƒ¼: ${dataItem.endpoint}`, error);
                }
            }

            // åŒæœŸçµæœã‚’ä¿å­˜
            pendingSyncData = failedData;
            localStorage.setItem('pendingSyncData', JSON.stringify(pendingSyncData));

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
            if (successCount > 0) {
                alert(`${successCount}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸã—ã¾ã—ãŸ`);
            }

            if (failedData.length > 0) {
                alert(`${failedData.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸã€‚å¾Œã§å†è©¦è¡Œã—ã¾ã™ã€‚`);
            }

            updateConnectionStatus();
        }

        function addPendingSyncData(endpoint, data, method = 'POST') {
            pendingSyncData.push({
                endpoint: endpoint,
                data: data,
                method: method,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('pendingSyncData', JSON.stringify(pendingSyncData));
            updateConnectionStatus();
        }

        // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆç›£è¦–
        window.addEventListener('online', () => {
            console.log('ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«å¾©å¸°ã—ã¾ã—ãŸ');
            updateConnectionStatus();
        });

        window.addEventListener('offline', () => {
            console.log('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã«ãªã‚Šã¾ã—ãŸ');
            updateConnectionStatus();
        });

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.addEventListener('DOMContentLoaded', () => {
            // all_spots_array.jsã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ç¢ºèª
            if (typeof hoshibaSpots !== 'undefined') {
                console.log(`Loaded ${hoshibaSpots.length} hoshiba spots from all_spots_array.js`);
                // H_1174_2017ã®æ‰€å±ç¢ºèª
                const spot = hoshibaSpots.find(s => s.name === 'H_1174_2017');
                if (spot) {
                    console.log(`H_1174_2017: ${spot.town}, ${spot.district}, ${spot.buraku}`);
                }
            } else {
                console.error('hoshibaSpots not loaded from all_spots_array.js');
            }

            addHoshibaMarkers();

            document.getElementById('showFavoritesBtn').addEventListener('click', showFavorites);
            document.getElementById('clearFavoritesBtn').addEventListener('click', clearAllFavorites);

            // é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
            initializeNotifications();
            if (notificationData.enabled) {
                scheduleNextNotification();
            }

            // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³çŠ¶æ…‹åˆæœŸåŒ–
            updateConnectionStatus();
        });

        // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€ä¿¡æ©Ÿèƒ½
        function submitFeedback(date, rating) {
            if (!selectedSpot) return;

            const feedbackKey = `${selectedSpot.name}_${date}`;

            // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ä¿å­˜
            feedbackData[feedbackKey] = {
                spot: selectedSpot.name,
                date: date,
                rating: rating,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('forecastFeedback', JSON.stringify(feedbackData));

            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’å¤‰æ›´
            const buttons = document.querySelectorAll(`[onclick*="${date}"]`);
            buttons.forEach(btn => {
                btn.classList.add('feedback-submitted');
                btn.textContent = 'é€ä¿¡æ¸ˆã¿';
                btn.onclick = null;
            });

            // ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            showFeedbackMessage(`${date}ã®ä¹¾ç‡¥çŠ¶æ³ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é€ä¿¡ã—ã¾ã—ãŸ`);

            // ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ï¼ˆå®Ÿè£…æ™‚ï¼‰
            sendFeedbackToServer(feedbackKey, feedbackData[feedbackKey]);
        }

        function showFeedbackMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 15px 20px;
                border-radius: 5px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                z-index: 1000;
                font-size: 14px;
            `;
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);

            setTimeout(() => {
                document.body.removeChild(messageDiv);
            }, 3000);
        }

        async function sendFeedbackToServer(key, data) {
            try {
                await fetch('/api/feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ key, data })
                });
            } catch (error) {
                console.log('ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã—ãŸ');
            }
        }

        // å¹²å ´ç®¡ç†æ©Ÿèƒ½
        let addSpotMode = false;

        function enableAddSpotMode() {
            addSpotMode = !addSpotMode;
            const btn = document.getElementById('addSpotBtn');
            const instructions = document.getElementById('addSpotInstructions');

            if (addSpotMode) {
                btn.textContent = 'âŒ è¿½åŠ ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†';
                btn.style.background = '#dc3545';
                instructions.style.display = 'block';
                map.getContainer().style.cursor = 'crosshair';
            } else {
                btn.textContent = 'â• æ–°ã—ã„å¹²å ´ã‚’è¿½åŠ ';
                btn.style.background = '#28a745';
                instructions.style.display = 'none';
                map.getContainer().style.cursor = '';
            }
        }

        async function addSpotAtLocation(lat, lon) {
            try {
                const response = await fetch('/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        lat: lat,
                        lon: lon,
                        town: '',
                        district: '',
                        buraku: ''
                    })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    alert(`æ–°ã—ã„å¹²å ´ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸ: ${result.spot.name}`);
                    // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦æ–°ã—ã„å¹²å ´ã‚’è¡¨ç¤º
                    location.reload();
                } else {
                    alert(`ã‚¨ãƒ©ãƒ¼: ${result.message}`);
                }
            } catch (error) {
                alert(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
            }
        }

        async function deleteSpot(index) {
            const spot = hoshibaSpots[index];

            if (!confirm(`æœ¬å½“ã«ã€Œ${spot.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
                return;
            }

            try {
                const response = await fetch('/delete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: spot.name
                    })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    alert(`å¹²å ´ã€Œ${spot.name}ã€ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ`);
                    // ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦å¤‰æ›´ã‚’åæ˜ 
                    location.reload();
                } else {
                    alert(`ã‚¨ãƒ©ãƒ¼: ${result.message}`);
                }
            } catch (error) {
                alert(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
            }
        }

        // åœ°å›³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        map.on('click', function(e) {
            if (addSpotMode) {
                const lat = e.latlng.lat;
                const lon = e.latlng.lng;
                addSpotAtLocation(lat, lon);
                enableAddSpotMode(); // è¿½åŠ ãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†
            }
        });

        // è¨˜éŒ²æ©Ÿèƒ½
        let currentRecordSpotIndex = null;

        function showRecordForm(index) {
            console.log('showRecordForm called with index:', index);
            currentRecordSpotIndex = index;
            const spot = hoshibaSpots[index];
            console.log('Selected spot:', spot);

            const container = document.getElementById('recordFormContainer');
            const spotInfo = document.getElementById('recordSpotInfo');
            const dateInput = document.getElementById('recordDate');
            const existingInfo = document.getElementById('existingRecordInfo');

            console.log('Container element:', container);

            if (!container) {
                console.error('Record form container not found!');
                return;
            }

            // å¹²å ´æƒ…å ±ã‚’è¡¨ç¤º
            spotInfo.innerHTML = `<strong>${spot.name}</strong><br><small>${spot.town} ${spot.district}</small>`;

            // ä»Šæ—¥ã®æ—¥ä»˜ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«è¨­å®š
            const today = new Date().toISOString().split('T')[0];
            dateInput.value = today;

            // æ—¢å­˜è¨˜éŒ²ã‚’ã‚¯ãƒªã‚¢
            existingInfo.innerHTML = '';

            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
            container.style.display = 'block';
            console.log('Record form should be visible now');

            // æ—¥ä»˜å¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            dateInput.onchange = function() {
                checkExistingRecord(spot.name, this.value);
            };

            // åˆæœŸãƒã‚§ãƒƒã‚¯
            checkExistingRecord(spot.name, today);
        }

        async function checkExistingRecord(name, date) {
            try {
                const response = await fetch(`/record/${name}/${date}`);
                const data = await response.json();
                const existingInfo = document.getElementById('existingRecordInfo');

                if (data.exists) {
                    existingInfo.innerHTML = `
                        <div class="existing-record">
                            <strong>æ—¢å­˜ã®è¨˜éŒ²:</strong><br>
                            ${data.record.date}: ${data.record.result}<br>
                            <small>è¨˜éŒ²ã‚’å¤‰æ›´ã™ã‚‹å ´åˆã¯ã€ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</small>
                        </div>
                    `;
                } else {
                    existingInfo.innerHTML = '';
                }
            } catch (error) {
                console.error('è¨˜éŒ²ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        async function submitRecord(result) {
            if (currentRecordSpotIndex === null) return;

            const spot = hoshibaSpots[currentRecordSpotIndex];
            const date = document.getElementById('recordDate').value;

            if (!date) {
                alert('æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            try {
                const response = await fetch('/record', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: spot.name,
                        date: date,
                        result: result
                    })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    alert(data.message);
                    closeRecordForm();
                } else {
                    alert(`ã‚¨ãƒ©ãƒ¼: ${data.message}`);
                }
            } catch (error) {
                alert(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
            }
        }

        function closeRecordForm() {
            document.getElementById('recordFormContainer').style.display = 'none';
            currentRecordSpotIndex = null;
        }

        // ============================================================
        // ç­‰å€¤ç·šãƒãƒƒãƒ—è¡¨ç¤ºæ©Ÿèƒ½
        // ============================================================

        let currentContourType = '500hpa';
        let currentContourTime = 0;
        let calibrationData = null;

        // äºˆå ±è£œæ­£æƒ…å ±ã‚’å–å¾—
        async function loadCalibrationData() {
            try {
                const response = await fetch('/api/forecast_calibration');
                calibrationData = await response.json();
                updateCalibrationDisplay();
            } catch (error) {
                console.error('è£œæ­£æƒ…å ±ã®å–å¾—ã«å¤±æ•—:', error);
            }
        }

        // è£œæ­£æƒ…å ±ã®è¡¨ç¤ºã‚’æ›´æ–°
        function updateCalibrationDisplay() {
            if (!calibrationData) return;

            const detailsDiv = document.getElementById('calibrationDetails');
            const weights = calibrationData.weights;

            detailsDiv.innerHTML = `
                <div style="margin-top: 8px;">
                    <div style="margin-bottom: 5px;">
                        <strong>500hPa æ¸¦åº¦:</strong>
                        ä¿¡é ¼åº¦ ${(weights.vorticity_500hPa * 100).toFixed(0)}%
                        ${weights.vorticity_500hPa < 0.5 ? 'âš ï¸ è¦æ³¨æ„' : 'âœ“ ä½¿ç”¨å¯'}
                    </div>
                    <div>
                        <strong>700hPa é‰›ç›´æµ:</strong>
                        ä¿¡é ¼åº¦ ${(weights.omega_700hPa * 100).toFixed(0)}%
                        ${weights.omega_700hPa < 0.5 ? 'âš ï¸ è¦æ³¨æ„' : 'âœ“ ä½¿ç”¨å¯'}
                    </div>
                </div>
            `;
        }

        // ç­‰å€¤ç·šãƒãƒƒãƒ—ã®ç¨®é¡ã‚’åˆ‡ã‚Šæ›¿ãˆ
        function showContourMap(type) {
            currentContourType = type;

            // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
            document.getElementById('contour500Btn').style.background = type === '500hpa' ? '#667eea' : '#e9ecef';
            document.getElementById('contour500Btn').style.color = type === '500hpa' ? 'white' : '#333';
            document.getElementById('contour700Btn').style.background = type === '700hpa' ? '#667eea' : '#e9ecef';
            document.getElementById('contour700Btn').style.color = type === '700hpa' ? 'white' : '#333';

            // ãƒãƒƒãƒ—ç”»åƒã‚’æ›´æ–°
            updateContourImage();
        }

        // ç­‰å€¤ç·šãƒãƒƒãƒ—ç”»åƒã‚’æ›´æ–°
        function updateContourImage() {
            const img = document.getElementById('contourMapImage');
            const caption = document.getElementById('contourMapCaption');

            const timeStr = `t${String(currentContourTime).padStart(4, '0')}`;

            if (currentContourType === '500hpa') {
                img.src = `/api/contour/contour_500hpa_${timeStr}.png`;
                caption.textContent = '500hPa é«˜åº¦å ´ãƒ»ç›¸å¯¾æ¸¦åº¦';
            } else {
                img.src = `/api/contour/contour_700hpa_omega_${timeStr}.png`;
                caption.textContent = '700hPa é«˜åº¦å ´ãƒ»é‰›ç›´Pé€Ÿåº¦';
            }
        }

        // ã‚¨ãƒã‚°ãƒ©ãƒ ç”¨Chart.jsã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        let emagramChart = null;

        // ã‚¨ãƒã‚°ãƒ©ãƒ æ™‚åˆ»é¸æŠè‚¢ã‚’ç”Ÿæˆï¼ˆå›ºå®šæ™‚åˆ»: å„æ—¥ã®6, 9, 12, 15, 18æ™‚JSTï¼‰
        function generateEmagramTimeOptions() {
            updateEmagramTimeOptions();
        }

        // ã‚¨ãƒã‚°ãƒ©ãƒ æ™‚åˆ»é¸æŠè‚¢ã‚’æ›´æ–°ï¼ˆé¸æŠã•ã‚ŒãŸäºˆå ±æ—¥ã«åŸºã¥ãï¼‰
        function updateEmagramTimeOptions() {
            console.log('updateEmagramTimeOptions called, currentForecastDay:', currentForecastDay);

            const select = document.getElementById('emagramTimeSelect');
            if (!select) {
                console.log('emagramTimeSelect element not found');
                return;
            }

            const now = new Date();
            const currentHour = now.getHours();
            console.log('Current hour:', currentHour);

            let options = '';

            // ä½œæ¥­æ™‚é–“å¸¯ã®å›ºå®šæ™‚åˆ»ï¼ˆJSTï¼‰
            const workHours = [6, 9, 12, 15, 18];

            // é¸æŠã•ã‚ŒãŸæ—¥ã®ã¿ã®æ™‚åˆ»ã‚’è¡¨ç¤º
            const day = currentForecastDay;
            const dayLabel = day === 0 ? 'ä»Šæ—¥' : day === 1 ? 'æ˜æ—¥' : day === 2 ? 'æ˜å¾Œæ—¥' : `${day}æ—¥å¾Œ`;
            console.log('Generating options for day:', day, '(', dayLabel, ')');

            workHours.forEach(hour => {
                // ä»Šæ—¥ã®å ´åˆã€éå»ã®æ™‚åˆ»ã¯ã‚¹ã‚­ãƒƒãƒ—
                if (day === 0 && hour <= currentHour) {
                    console.log('Skipping past hour:', hour);
                    return;
                }

                // ç¾åœ¨æ™‚åˆ»ã‹ã‚‰ã®çµŒéæ™‚é–“ã‚’è¨ˆç®—
                let hoursFromNow = (day * 24) + (hour - currentHour);

                // 168æ™‚é–“ï¼ˆ7æ—¥é–“ï¼‰ä»¥å†…
                if (hoursFromNow >= 0 && hoursFromNow <= 168) {
                    const timeLabel = `${hour}æ™‚`;
                    options += `<option value="${hoursFromNow}">${timeLabel} (${hoursFromNow}hå¾Œ)</option>`;
                    console.log('Added option:', hour, 'h (', hoursFromNow, 'h from now)');
                }
            });

            console.log('Total options generated:', options ? 'yes' : 'no');
            select.innerHTML = options;

            // ã‚¨ãƒã‚°ãƒ©ãƒ ã‚’è‡ªå‹•çš„ã«æ›´æ–°
            if (options && selectedSpot) {
                console.log('Calling loadEmagramData()');
                loadEmagramData();
            } else {
                console.log('Not loading emagram - options:', !!options, 'selectedSpot:', !!selectedSpot);
            }
        }

        // ã‚¨ãƒã‚°ãƒ©ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        async function loadEmagramData() {
            const timeOffset = document.getElementById('emagramTimeSelect').value;
            const spot = hoshibaSpots[currentSpotId];

            if (!spot) return;

            try {
                const response = await fetch(`/api/emagram?lat=${spot.lat}&lon=${spot.lon}&time=${timeOffset}`);
                const result = await response.json();

                if (result.status === 'success') {
                    drawEmagram(result.data);
                } else {
                    console.error('Failed to load emagram data:', result.message);
                }
            } catch (error) {
                console.error('Error loading emagram:', error);
            }
        }

        // ã‚¨ãƒã‚°ãƒ©ãƒ ã‚’æç”»
        function drawEmagram(data) {
            const ctx = document.getElementById('emagramCanvas').getContext('2d');

            // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
            if (emagramChart) {
                emagramChart.destroy();
            }

            // ãƒ‡ãƒ¼ã‚¿ã¯ãã®ã¾ã¾ä½¿ç”¨ï¼ˆreverseã—ãªã„ï¼‰
            const pressures = data.pressure;
            const temps = data.temperature;
            const dewpoints = data.dewpoint;

            // æ°—æ¸©ã¨æ°—åœ§ã®ãƒšã‚¢ã‚’ä½œæˆï¼ˆXè»¸=æ°—æ¸©ã€Yè»¸=æ°—åœ§ï¼‰
            const tempPoints = temps.map((t, i) => ({ x: t, y: pressures[i] }));
            const dewpointPoints = dewpoints.map((d, i) => ({ x: d, y: pressures[i] }));

            emagramChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'æ°—æ¸© (Â°C)',
                            data: tempPoints,
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: '#dc3545',
                            tension: 0.1
                        },
                        {
                            label: 'éœ²ç‚¹æ¸©åº¦ (Â°C)',
                            data: dewpointPoints,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            borderWidth: 3,
                            pointRadius: 4,
                            pointBackgroundColor: '#007bff',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'æ°—æ¸© (Â°C)',
                                font: { size: 14, weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            type: 'linear',
                            reverse: true,
                            title: {
                                display: true,
                                text: 'æ°—åœ§ (hPa)',
                                font: { size: 14, weight: 'bold' }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: { size: 12 },
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return `æ°—åœ§: ${context[0].parsed.y} hPa`;
                                },
                                label: function(context) {
                                    const value = context.parsed.x;
                                    const dataset = context.dataset.label;
                                    return `${dataset}: ${value.toFixed(1)}Â°C`;
                                },
                                afterLabel: function(context) {
                                    const index = context.dataIndex;
                                    const temp = temps[index];
                                    const dewpoint = dewpoints[index];
                                    const spread = temp - dewpoint;
                                    const relHumidity = 100 - (spread * 5); // ç°¡æ˜“è¨ˆç®—
                                    return `T-Td: ${spread.toFixed(1)}Â°C (RHâ‰ˆ${Math.max(0, relHumidity).toFixed(0)}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // è§£ææƒ…å ±ã‚’è¿½åŠ 
            updateEmagramAnalysis(data);
        }

        // ã‚¨ãƒã‚°ãƒ©ãƒ è§£ææƒ…å ±ã‚’æ›´æ–°
        function updateEmagramAnalysis(data) {
            const infoDiv = document.getElementById('emagramInfo');

            // é€†è»¢å±¤ã®æ¤œå‡º
            let inversionLayers = [];
            for (let i = 0; i < data.temperature.length - 1; i++) {
                if (data.temperature[i+1] > data.temperature[i]) {
                    inversionLayers.push({
                        pressure: data.pressure[i],
                        height: data.height[i],
                        strength: data.temperature[i+1] - data.temperature[i]
                    });
                }
            }

            // é›²åº•é«˜åº¦ã®æ¨å®šï¼ˆéœ²ç‚¹å·®ãŒ2â„ƒä»¥ä¸‹ã®æœ€ä½å±¤ï¼‰
            let cloudBase = null;
            for (let i = data.temperature.length - 1; i >= 0; i--) {
                const spread = data.temperature[i] - data.dewpoint[i];
                if (spread <= 2.0) {
                    cloudBase = {
                        pressure: data.pressure[i],
                        height: data.height[i]
                    };
                    break;
                }
            }

            // 850hPaã®æ¹¿åº¦ï¼ˆéœ§ç™ºç”Ÿã®ç›®å®‰ï¼‰
            const idx850 = data.pressure.indexOf(850);
            let humidity850 = null;
            if (idx850 >= 0) {
                const spread850 = data.temperature[idx850] - data.dewpoint[idx850];
                humidity850 = 100 - (spread850 * 5); // ç°¡æ˜“è¨ˆç®—
            }

            // è§£æçµæœã‚’è¡¨ç¤º
            let analysisHTML = `
                <div style="margin-bottom: 8px;">
                    <strong>ğŸ“Œ èª­ã¿æ–¹:</strong>
                </div>
                <ul style="margin: 5px 0; padding-left: 20px; line-height: 1.8;">
                    <li><span style="color: #dc3545; font-weight: bold;">èµ¤ç·š</span>: æ°—æ¸©ï¼ˆå³ã«é«˜æ¸©ï¼‰</li>
                    <li><span style="color: #007bff; font-weight: bold;">é’ç·š</span>: éœ²ç‚¹æ¸©åº¦ï¼ˆæ°—æ¸©ã«è¿‘ã„ã»ã©æ¹¿æ½¤ï¼‰</li>
                    <li><strong>æ°—æ¸©ã¨éœ²ç‚¹ãŒæ¥è¿‘</strong>: æ¹¿åº¦100%ã«è¿‘ã„ï¼ˆéœ§ãƒ»é›²ç™ºç”Ÿå±¤ï¼‰</li>
                    <li><strong>æ°—æ¸©ãŒä¸Šã«å‘ã‹ã£ã¦ä¸Šæ˜‡</strong>: é€†è»¢å±¤ï¼ˆéœ§ãƒ»æ±šæŸ“ç‰©è³ªã®é–‰ã˜è¾¼ã‚ï¼‰</li>
                    <li><strong>æ°—æ¸©ã¨éœ²ç‚¹ã®å·®ãŒå¤§ãã„</strong>: ä¹¾ç‡¥ã—ãŸç©ºæ°—ï¼ˆä¹¾ç‡¥ã«æœ‰åˆ©ï¼‰</li>
                </ul>

                <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 3px;">
                    <strong>ğŸ” è‡ªå‹•è§£æçµæœ:</strong>
                    <ul style="margin: 8px 0; padding-left: 20px;">
            `;

            if (inversionLayers.length > 0) {
                analysisHTML += `<li><strong>é€†è»¢å±¤:</strong> ${inversionLayers.length}å±¤æ¤œå‡º`;
                inversionLayers.forEach(inv => {
                    analysisHTML += ` (${inv.pressure}hPaä»˜è¿‘ +${inv.strength.toFixed(1)}Â°C)`;
                });
                analysisHTML += ` âš ï¸ éœ§ã®æŒç¶šãƒ»ç™ºé”ã«æ³¨æ„</li>`;
            } else {
                analysisHTML += `<li><strong>é€†è»¢å±¤:</strong> ãªã— âœ“ å¤§æ°—æ··åˆè‰¯å¥½</li>`;
            }

            if (cloudBase) {
                analysisHTML += `<li><strong>æ¨å®šé›²åº•:</strong> ${(cloudBase.height/1000).toFixed(1)}km (${cloudBase.pressure}hPa) ğŸŒ«ï¸</li>`;
            } else {
                analysisHTML += `<li><strong>æ¨å®šé›²åº•:</strong> ãªã—ï¼ˆæ™´å¤©ï¼‰ â˜€ï¸</li>`;
            }

            if (humidity850 !== null) {
                const fogRisk = humidity850 >= 95 ? 'âš ï¸ é«˜' : humidity850 >= 90 ? 'â–³ ä¸­' : 'âœ“ ä½';
                analysisHTML += `<li><strong>850hPaæ¹¿åº¦:</strong> ${humidity850.toFixed(0)}% (éœ§ãƒªã‚¹ã‚¯: ${fogRisk})</li>`;
            }

            analysisHTML += `
                    </ul>
                </div>
            `;

            infoDiv.innerHTML = analysisHTML;
        }

        // å¹²å ´é¸æŠæ™‚ã«ã‚¨ãƒã‚°ãƒ©ãƒ ã¨ç­‰å€¤ç·šãƒãƒƒãƒ—ã‚’è¡¨ç¤º
        const originalSelectSpot = selectSpot;
        selectSpot = function(spotId) {
            originalSelectSpot(spotId);
            currentSpotId = spotId;

            // ã‚¨ãƒã‚°ãƒ©ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            document.getElementById('emagramSection').style.display = 'block';

            // ã‚¨ãƒã‚°ãƒ©ãƒ æ™‚åˆ»é¸æŠè‚¢ã‚’ç”Ÿæˆ
            generateEmagramTimeOptions();

            // ã‚¨ãƒã‚°ãƒ©ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            loadEmagramData();

            // ç­‰å€¤ç·šãƒãƒƒãƒ—ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            document.getElementById('contourMapSection').style.display = 'block';

            // åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚
            if (!calibrationData) {
                loadCalibrationData();
            }

            // æœ€åˆã®ãƒãƒƒãƒ—ã‚’è¡¨ç¤º
            showContourMap('500hpa');
        };

        // ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function switchSidebarTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
            document.querySelectorAll('.sidebar-tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.style.borderBottomColor = 'transparent';
                btn.style.color = '#6c757d';
                btn.style.fontWeight = '500';
            });

            document.querySelectorAll('.sidebar-tab-content').forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });

            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
                activeBtn.style.borderBottomColor = '#667eea';
                activeBtn.style.color = '#667eea';
                activeBtn.style.fontWeight = '600';
            }

            const activeContent = document.getElementById(`${tabName}TabContent`);
            if (activeContent) {
                activeContent.classList.add('active');
                activeContent.style.display = 'block';
            }

            // ç­‰å€¤ç·šã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆãŸæ™‚ã€æ™‚åˆ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–
            if (tabName === 'contour') {
                updateContourTimeOptions();
            }
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«å¿œã˜ã¦æ™‚åˆ»ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å‹•çš„ç”Ÿæˆ
        function updateContourTimeOptions() {
            const category = document.getElementById('contourCategory').value;
            const timeSelect = document.getElementById('contourTime');

            if (!category) {
                timeSelect.innerHTML = '<option value="">-- ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å…ˆã«é¸æŠ --</option>';
                return;
            }

            // åœ°ä¸Šãƒ¬ãƒ™ãƒ«ã‹æµ·åŸŸãƒ¬ãƒ™ãƒ«ã‹é«˜å±¤ãƒ¬ãƒ™ãƒ«ã‹ã‚’åˆ¤å®š
            const isSurface = ['temperature', 'humidity', 'pressure', 'wind', 'precipitation'].includes(category);
            const isMarine = ['wave_height', 'wave_direction_period'].includes(category);
            const isUpperAir = ['vorticity_500hpa', 'omega_700hpa', 'theta_e_850hpa',
                                'jet_stream_300hpa', 'height_anomaly_200hpa'].includes(category);

            let options = '';

            if (isSurface || isMarine) {
                // åœ°ä¸Šãƒ¬ãƒ™ãƒ«ãƒ»æµ·åŸŸãƒ¬ãƒ™ãƒ«ï¼ˆæ¼å¸«å‘ã‘ï¼‰ï¼š1æ™‚é–“åˆ»ã¿ã€0-168æ™‚é–“ï¼ˆ7æ—¥é–“ï¼‰
                options += '<optgroup label="çŸ­æœŸè©³ç´°ï¼ˆ1æ™‚é–“åˆ»ã¿ï¼‰">';
                options += '<option value="0">ç¾åœ¨</option>';
                for (let h = 1; h <= 48; h++) {
                    options += `<option value="${h}">${h}æ™‚é–“å¾Œ</option>`;
                }
                options += '</optgroup>';

                options += '<optgroup label="é€±é–“äºˆå ±ï¼ˆ3æ™‚é–“åˆ»ã¿ï¼‰">';
                for (let h = 51; h <= 168; h += 3) {
                    const days = Math.floor(h / 24);
                    const hours = h % 24;
                    options += `<option value="${h}">${h}æ™‚é–“å¾Œ (${days}æ—¥${hours}æ™‚é–“å¾Œ)</option>`;
                }
                options += '</optgroup>';
            } else if (isUpperAir) {
                // é«˜å±¤ãƒ¬ãƒ™ãƒ«ï¼ˆå°‚é–€å®¶å‘ã‘ï¼‰ï¼š3æ™‚é–“åˆ»ã¿ã€0-384æ™‚é–“ï¼ˆ16æ—¥é–“ï¼‰
                options += '<optgroup label="çŸ­æœŸäºˆå ±ï¼ˆ3æ™‚é–“åˆ»ã¿ï¼‰">';
                options += '<option value="0">ç¾åœ¨</option>';
                for (let h = 3; h <= 72; h += 3) {
                    options += `<option value="${h}">${h}æ™‚é–“å¾Œ</option>`;
                }
                options += '</optgroup>';

                options += '<optgroup label="é€±é–“äºˆå ±ï¼ˆ6æ™‚é–“åˆ»ã¿ï¼‰">';
                for (let h = 78; h <= 168; h += 6) {
                    const days = Math.floor(h / 24);
                    options += `<option value="${h}">${h}æ™‚é–“å¾Œ (${days}æ—¥ç›®)</option>`;
                }
                options += '</optgroup>';

                options += '<optgroup label="é•·æœŸå‚¾å‘ï¼ˆ12æ™‚é–“åˆ»ã¿ãƒ»å‚è€ƒï¼‰">';
                for (let h = 180; h <= 384; h += 12) {
                    const days = Math.floor(h / 24);
                    options += `<option value="${h}">${h}æ™‚é–“å¾Œ (${days}æ—¥ç›®ãƒ»å‚è€ƒ)</option>`;
                }
                options += '</optgroup>';
            }

            timeSelect.innerHTML = options;
        }

        // ç­‰å€¤ç·šè§£æãƒãƒƒãƒ—ã‚’èª­ã¿è¾¼ã¿
        async function loadContourAnalysis() {
            const category = document.getElementById('contourCategory').value;
            const timeOffset = document.getElementById('contourTime').value;

            if (!category) {
                alert('è§£æã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const displayDiv = document.getElementById('contourMapDisplay');
            const imageDiv = document.getElementById('contourMapImage');
            const metadataDiv = document.getElementById('contourMetadata');

            // è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’è¡¨ç¤º
            displayDiv.style.display = 'block';
            imageDiv.innerHTML = '<p style="color: #999;">è§£æå›³ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>';
            metadataDiv.innerHTML = '';

            try {
                // APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                const response = await fetch(`/api/analysis/contours?type=${category}&time=${timeOffset}`);
                const data = await response.json();

                if (data.status === 'success') {
                    // ç”»åƒè¡¨ç¤º
                    if (data.visualization_url) {
                        imageDiv.innerHTML = `
                            <img src="${data.visualization_url}"
                                 alt="${data.map_type}è§£æå›³"
                                 style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                        `;
                    } else if (data.contour_data) {
                        // ãƒ‡ãƒ¼ã‚¿ã®ã¿ã®å ´åˆã¯ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤º
                        imageDiv.innerHTML = `
                            <div style="background: white; padding: 15px; border-radius: 8px; text-align: left; max-height: 300px; overflow-y: auto;">
                                <pre style="margin: 0; font-size: 0.75rem;">${JSON.stringify(data.contour_data, null, 2)}</pre>
                            </div>
                        `;
                    } else if (data.parameter) {
                        // APIã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æƒ…å ±ãŒè¿”ã•ã‚ŒãŸå ´åˆ
                        let valueDisplay = '';
                        if (data.value !== undefined && data.value !== null) {
                            valueDisplay = `<p style="font-size: 1.2rem; color: #667eea; margin: 10px 0;"><strong>${data.value} ${data.unit || ''}</strong></p>`;
                        } else if (data.wind_speed !== undefined || data.wind_direction !== undefined) {
                            valueDisplay = `<p style="font-size: 1.2rem; color: #667eea; margin: 10px 0;"><strong>é¢¨é€Ÿ: ${data.wind_speed || '--'} ${data.unit || 'm/s'} / é¢¨å‘: ${data.wind_direction || '--'}Â°</strong></p>`;
                        } else if (data.wave_height !== undefined) {
                            valueDisplay = `<p style="font-size: 1.2rem; color: #667eea; margin: 10px 0;"><strong>${data.wave_height || '--'} ${data.unit || 'm'}</strong></p>`;
                            if (data.work_safety) {
                                valueDisplay += `<p style="margin: 10px 0; padding: 10px; background: ${data.work_safety.includes('å±é™º') ? '#fee' : data.work_safety.includes('æ³¨æ„') ? '#ffe' : '#efe'}; border-radius: 5px;"><strong>ä½œæ¥­å®‰å…¨åº¦:</strong> ${data.work_safety}</p>`;
                            }
                        } else if (data.temperature_500hpa !== undefined) {
                            valueDisplay = `<p style="font-size: 1.2rem; color: #667eea; margin: 10px 0;"><strong>500hPaæ°—æ¸©: ${data.temperature_500hpa}Â°C</strong></p>`;
                        } else if (data.temperature_700hpa !== undefined) {
                            valueDisplay = `<p style="font-size: 1.2rem; color: #667eea; margin: 10px 0;"><strong>700hPaæ°—æ¸©: ${data.temperature_700hpa}Â°C</strong></p>`;
                        } else if (data.equivalent_potential_temperature !== undefined) {
                            valueDisplay = `<p style="font-size: 1.2rem; color: #667eea; margin: 10px 0;"><strong>ç›¸å½“æ¸©ä½: ${data.equivalent_potential_temperature} K</strong></p>`;
                        }

                        imageDiv.innerHTML = `
                            <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
                                <p style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">${data.parameter}</p>
                                ${valueDisplay}
                                ${data.message ? `<p style="font-size: 0.85rem; color: #666; margin-top: 10px;">${data.message}</p>` : ''}
                            </div>
                        `;
                    } else {
                        imageDiv.innerHTML = '<p style="color: #dc3545;">è§£æãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
                    }

                    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
                    const categoryInfo = {
                        'temperature': { name: 'ç­‰æ¸©ç·šï¼ˆæ°—æ¸©åˆ†å¸ƒï¼‰', level: 'åœ°ä¸Š', interval: '1æ™‚é–“åˆ»ã¿' },
                        'humidity': { name: 'ç­‰æ¹¿ç·šï¼ˆæ¹¿åº¦åˆ†å¸ƒï¼‰', level: 'åœ°ä¸Š', interval: '1æ™‚é–“åˆ»ã¿' },
                        'pressure': { name: 'ç­‰åœ§ç·šï¼ˆæ°—åœ§åˆ†å¸ƒï¼‰', level: 'åœ°ä¸Š', interval: '1æ™‚é–“åˆ»ã¿' },
                        'wind': { name: 'é¢¨å‘ãƒ»é¢¨é€Ÿå ´', level: 'åœ°ä¸Š', interval: '1æ™‚é–“åˆ»ã¿' },
                        'precipitation': { name: 'é™æ°´é‡åˆ†å¸ƒ', level: 'åœ°ä¸Š', interval: '1æ™‚é–“åˆ»ã¿' },
                        'wave_height': { name: 'æœ‰ç¾©æ³¢é«˜åˆ†å¸ƒ', level: 'æµ·é¢', interval: '1æ™‚é–“åˆ»ã¿' },
                        'wave_direction_period': { name: 'æ³¢å‘ãƒ»æ³¢å‘¨æœŸå ´', level: 'æµ·é¢', interval: '1æ™‚é–“åˆ»ã¿' },
                        'vorticity_500hpa': { name: 'æ¸¦åº¦å ´', level: '500hPa', interval: '3æ™‚é–“åˆ»ã¿' },
                        'omega_700hpa': { name: 'é‰›ç›´æµ', level: '700hPa', interval: '3æ™‚é–“åˆ»ã¿' },
                        'theta_e_850hpa': { name: 'ç›¸å½“æ¸©ä½ï¼ˆæ¹¿èˆŒæ¤œå‡ºï¼‰', level: '850hPa', interval: '3æ™‚é–“åˆ»ã¿' },
                        'jet_stream_300hpa': { name: 'ã‚¸ã‚§ãƒƒãƒˆæ°—æµ', level: '300hPa', interval: '3æ™‚é–“åˆ»ã¿' },
                        'height_anomaly_200hpa': { name: 'é«˜åº¦åå·®ï¼ˆãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°æ¤œå‡ºï¼‰', level: '200hPa', interval: '3æ™‚é–“åˆ»ã¿' }
                    };

                    const info = categoryInfo[category] || { name: category, level: 'ä¸æ˜', interval: 'ä¸æ˜' };
                    const timeOffsetNum = parseInt(timeOffset);
                    const timeLabel = timeOffsetNum === 0 || timeOffset === 'current' ? 'ç¾åœ¨' : `${timeOffset}æ™‚é–“å¾Œ`;
                    const days = Math.floor(timeOffsetNum / 24);
                    const hours = timeOffsetNum % 24;

                    // äºˆå ±ç²¾åº¦ã®è©•ä¾¡
                    let accuracyNote = '';
                    if (timeOffsetNum <= 72) {
                        accuracyNote = '<span style="color: #28a745;">â—</span> é«˜ç²¾åº¦ï¼ˆçŸ­æœŸäºˆå ±ï¼‰';
                    } else if (timeOffsetNum <= 168) {
                        accuracyNote = '<span style="color: #ffc107;">â—</span> ä¸­ç²¾åº¦ï¼ˆé€±é–“äºˆå ±ï¼‰';
                    } else {
                        accuracyNote = '<span style="color: #dc3545;">â—</span> å‚è€ƒç¨‹åº¦ï¼ˆé•·æœŸå‚¾å‘ï¼‰';
                    }

                    metadataDiv.innerHTML = `
                        <div><strong>è§£æã‚«ãƒ†ã‚´ãƒªãƒ¼:</strong> ${info.name}</div>
                        <div><strong>æ°—åœ§é¢:</strong> ${info.level}</div>
                        <div><strong>æ™‚é–“åˆ†è§£èƒ½:</strong> ${info.interval}</div>
                        <div><strong>è§£ææ™‚åˆ»:</strong> ${timeLabel} ${days > 0 ? `(${days}æ—¥${hours}æ™‚é–“å¾Œ)` : ''} (JST)</div>
                        <div><strong>äºˆå ±ç²¾åº¦:</strong> ${accuracyNote}</div>
                        <div><strong>å¯¾è±¡ã‚¨ãƒªã‚¢:</strong> åˆ©å°»å³¶å…¨åŸŸ</div>
                        ${data.grid_resolution ? `<div><strong>æ ¼å­è§£åƒåº¦:</strong> ${data.grid_resolution}</div>` : ''}
                        ${data.interpolation_method ? `<div><strong>è£œé–“æ‰‹æ³•:</strong> ${data.interpolation_method}</div>` : ''}
                        ${data.data_source ? `<div><strong>ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹:</strong> ${data.data_source}</div>` : ''}
                        ${data.parameter ? `<div><strong>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:</strong> ${data.parameter} (${data.unit || ''})</div>` : ''}
                        ${data.equivalent_potential_temperature ? `<div><strong>ç›¸å½“æ¸©ä½å€¤:</strong> ${data.equivalent_potential_temperature.toFixed(1)} K</div>` : ''}
                        ${data.jet_intensity ? `<div><strong>ã‚¸ã‚§ãƒƒãƒˆå¼·åº¦:</strong> ${data.jet_intensity}</div>` : ''}
                        ${data.wind_speed_ms ? `<div><strong>é¢¨é€Ÿ:</strong> ${data.wind_speed_ms.toFixed(1)} m/s</div>` : ''}
                        ${data.height_anomaly !== undefined && data.height_anomaly !== null ? `<div><strong>é«˜åº¦åå·®:</strong> ${data.height_anomaly > 0 ? '+' : ''}${data.height_anomaly.toFixed(0)} m</div>` : ''}
                        ${data.anomaly_category ? `<div><strong>åå·®è©•ä¾¡:</strong> ${data.anomaly_category}</div>` : ''}
                        ${data.wave_height !== undefined && data.wave_height !== null ? `<div><strong>æœ‰ç¾©æ³¢é«˜:</strong> ${data.wave_height.toFixed(2)} m</div>` : ''}
                        ${data.work_safety ? `<div><strong>ä½œæ¥­å®‰å…¨åº¦:</strong> ${data.work_safety}</div>` : ''}
                        ${data.wave_period ? `<div><strong>æ³¢å‘¨æœŸ:</strong> ${data.wave_period.toFixed(1)} ç§’</div>` : ''}
                        ${data.wave_direction ? `<div><strong>æ³¢å‘:</strong> ${data.wave_direction.toFixed(0)}Â°</div>` : ''}
                        ${data.swell_condition ? `<div><strong>ã†ã­ã‚ŠçŠ¶æ…‹:</strong> ${data.swell_condition}</div>` : ''}
                        ${data.message ? `<div style="margin-top: 10px; padding: 8px; background: #e7f3ff; border-radius: 5px; color: #004085; font-size: 0.75rem;">ğŸ’¡ ${data.message}</div>` : ''}
                        ${timeOffsetNum > 168 ? `
                            <div style="margin-top: 10px; padding: 8px; background: #f8d7da; border-radius: 5px; color: #721c24; font-size: 0.75rem;">
                                âš ï¸ 8æ—¥ç›®ä»¥é™ã®äºˆå ±ã¯ç²¾åº¦ãŒä½ä¸‹ã—ã¾ã™ã€‚é•·æœŸçš„ãªæ°—åœ§é…ç½®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å‚¾å‘æŠŠæ¡ã«ã”åˆ©ç”¨ãã ã•ã„ã€‚
                            </div>
                        ` : ''}
                    `;
                } else {
                    imageDiv.innerHTML = `<p style="color: #dc3545;">ã‚¨ãƒ©ãƒ¼: ${data.message || 'è§£æå›³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ'}</p>`;
                }
            } catch (error) {
                console.error('ç­‰å€¤ç·šè§£æã‚¨ãƒ©ãƒ¼:', error);
                imageDiv.innerHTML = `<p style="color: #dc3545;">ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚„æ™‚åˆ»ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«è‡ªå‹•æ›´æ–°ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        function updateContourDisplay() {
            const category = document.getElementById('contourCategory').value;
            const time = document.getElementById('contourTime').value;

            if (category && time) {
                // è‡ªå‹•èª­ã¿è¾¼ã¿ã¯è¡Œã‚ãšã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚’ä¿ƒã™
                const displayDiv = document.getElementById('contourMapDisplay');
                if (displayDiv.style.display === 'block') {
                    // æ—¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯è‡ªå‹•æ›´æ–°
                    loadContourAnalysis();
                }
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹ï¼ˆpopupå†…ã§ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼‰
        window.selectSpot = selectSpot;
        window.toggleFavorite = toggleFavorite;
        window.submitFeedback = submitFeedback;
        window.enableAddSpotMode = enableAddSpotMode;
        window.deleteSpot = deleteSpot;
        window.showRecordForm = showRecordForm;
        window.submitRecord = submitRecord;
        window.closeRecordForm = closeRecordForm;
        window.showContourMap = showContourMap;
        window.switchSidebarTab = switchSidebarTab;
        window.loadContourAnalysis = loadContourAnalysis;
        window.updateContourDisplay = updateContourDisplay;
    </script>

</body>
</html>